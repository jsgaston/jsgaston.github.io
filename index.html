
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mi Página Completa</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; }
    .nav { display: flex; gap: 10px; background: #ddd; padding: 10px; }
    .nav button { padding: 10px; cursor: pointer; }
    .section { display: none; padding: 20px; }
    .section.active { display: block; }
    #map { height: 400px; width: 100%; }
    .song-list li { cursor: pointer; color: blue; }
  </style>
</head>
<body>
  <div class="nav">
    <button onclick="showSection('home')">Inicio</button>
    <button onclick="showSection('radio')">Radio</button>
    <button onclick="showSection('diario')">Diario</button>
    <button onclick="showSection('mapa')">Mapa</button>
  </div>

  <div id="home" class="section active">
    <h2>Bienvenido</h2>
    <p>Selecciona una sección para comenzar.</p>
  </div>

  <div id="radio" class="section">
    <h2>🎧 Mi Radio</h2>
    <ul id="songList" class="song-list"></ul>
    <audio id="audioPlayer" controls style="width:100%; margin-top:10px;"></audio>
  </div>

  <div id="diario" class="section">
    <h2>📓 Diario</h2>
    <form id="diaryForm">
      <input type="text" id="title" placeholder="Título" required><br><br>
      <textarea id="entry" placeholder="Escribe aquí..." rows="5" required></textarea><br><br>
      <button type="submit">Guardar</button>
    </form>
    <div id="diaryResult"></div>
    <hr>
    <h3>🔎 Buscar por Título</h3>
    <input type="text" id="searchTitle" placeholder="Buscar título...">
    <button onclick="searchByTitle()">Buscar</button>
    <div id="searchResults"></div>
  </div>

  <div id="mapa" class="section">
    <h2>🗺️ Mapa en Vivo</h2>
    <div id="map"></div>
  </div>

<script>
  const API_DIARIO = "https://script.google.com/macros/s/AKfycbxxxxxxxxxxxxxxxxxxxxxxxx/exec";
  const API_MAPS = "https://script.google.com/macros/s/AKfycbxxxxxxxxxxxxxxxxxxxxxxxx/exec";

  function showSection(id) { 
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active')); 
    document.getElementById(id).classList.add('active'); 
  }

  // RADIO
  const player = document.getElementById('audioPlayer');
  fetch('music_list.json')
    .then(res => res.json())
    .then(data => {
      const list = document.getElementById('songList');
      data.forEach((song, i) => {
        const li = document.createElement('li');
        li.textContent = song.title;
        li.onclick = () => {
          player.src = song.url;
          player.play();
        };
        list.appendChild(li);
      });
    });

  // DIARIO
  document.getElementById('diaryForm').addEventListener('submit', e => {
    e.preventDefault();
    const data = {
      title: document.getElementById('title').value,
      diaryEntry: document.getElementById('entry').value
    };
    fetch(API_DIARIO, {
      method: 'POST',
      body: JSON.stringify(data),
      headers: { 'Content-Type': 'application/json' }
    })
    .then(r => r.json())
    .then(res => {
      document.getElementById('diaryResult').textContent = res.message || 'Guardado';
    });
  });

  function searchByTitle() {
    const keyword = document.getElementById('searchTitle').value;
    fetch(API_DIARIO + "?action=searchByTitle&keyword=" + encodeURIComponent(keyword))
      .then(r => r.json())
      .then(res => {
        const div = document.getElementById('searchResults');
        div.innerHTML = '';
        res.entries?.forEach(e => {
          div.innerHTML += `<p><strong>${e.title}</strong>: ${e.text}</p>`;
        });
      });
  }

  // MAPA
  const map = L.map('map').setView([40.4168, -3.7038], 5);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
  }).addTo(map);

  fetch(API_MAPS)
    .then(res => res.json())
    .then(data => {
      data.forEach(p => {
        if (p.Latitude && p.Longitude)
          L.marker([+p.Latitude, +p.Longitude]).addTo(map)
            .bindPopup("📍 Pulsaciones: " + p.Pulse + "<br>SPO2: " + p.SpO2);
      });
    });
</script>
</body>
</html>
