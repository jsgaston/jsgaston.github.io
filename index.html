<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Javi</title>
    <link rel="icon" type="image/jpeg" href="mi%20bandera.jpg">

    <!--<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <!--<script src="https://cdn.tailwindcss.com"></script>
    <!-- Insertar en el <head> de tu HTML -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

    <style>
        /* Fuente Inter para un aspecto moderno y limpio */
          body {
            font-family: 'Inter', sans-serif; /* Assuming Inter is available or fallback to sans-serif */
            background-color: #f3f4f6; /* Light gray background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background-image: url('mi%20bandera.jpg'); /* Your background image */
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            margin: 0;
        }
        .container {
            background-color: #ffffff; /* White card background */
            padding: 2.5rem; /* Increased padding */
            border-radius: 0.75rem; /* More rounded corners */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); /* Stronger shadow */
            text-align: center;
            max-width: 60%;
            width: 60%;
            border: 1px solid #e5e7eb; /* Light border */
        }
        h1 {
            color: #1a202c; /* Darker heading color */
            margin-bottom: 1.5rem;
            font-size: 2rem; /* Larger heading */
            font-weight: 700; /* Bold */
        }
        .form-group {
            margin-bottom: 1.5rem;
            text-align: left; /* Align labels and inputs to the left */
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #4a5568; /* Medium gray for labels */
            font-weight: 600; /* Semi-bold label */
        }
        input[type="text"],
        input[type="datetime-local"],
        input[type="number"] { /* Added number type for numerical inputs */
            width: calc(100% - 20px); /* Adjust for padding */
            padding: 0.75rem 10px; /* More padding */
            border: 1px solid #cbd5e0; /* Light border for inputs */
            border-radius: 0.375rem; /* Slightly rounded corners */
            font-size: 1rem;
            color: #2d3748; /* Dark text in input */
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
        }
        input[type="text"]:focus,
        input[type="datetime-local"]:focus,
        input[type="number"]:focus {
            outline: none;
            border-color: #6366f1; /* Indigo border on focus */
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); /* Light indigo shadow on focus */
        }
        button {
            background-color: #6366f1; /* Indigo button */
            color: white;
            padding: 0.85rem 1.75rem; /* Larger button padding */
            border: none;
            border-radius: 0.375rem;
            font-size: 1.1rem; /* Larger font for button */
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            margin-top: 1.5rem;
        }
        button:hover {
            background-color: #4f46e5; /* Darker indigo on hover */
            transform: translateY(-1px); /* Slight lift effect */
        }
        #resultDisplay {
            margin-top: 2rem;
            padding: 1rem;
            background-color: #e0f2f7; /* Light blue background for results */
            border: 1px solid #bae6fd; /* Light blue border */
            border-radius: 0.5rem;
            color: #0c4a6e; /* Dark blue text */
            font-size: 1.1rem;
            font-weight: 500;
            text-align: left;
        }
        .input-group {
                        font-weight: 600;
            margin-bottom: 8px;
            display: block;
            color: #374151;
        }


 
        #resultDiv, #multiplicationResultDiv {
            margin-top: 25px;
            padding: 15px;
            border-radius: 8px;
            background-color: #e2e8f0; /* Un gris azulado claro para los resultados */
            color: #2d3748;
            font-size: 1.1em;
            text-align: center;
            word-wrap: break-word; /* Para asegurar que el texto largo se ajuste */
        }
        #multiplicationResultDiv {
            background-color: #d1fae5; /* Verde claro para el resultado de multiplicaci√≥n */
            color: #065f46;
            font-weight: 600;
            display: none; /* Hidden by default */
        }
        .error {
            color: #e53e3e; /* Rojo para mensajes de error */
            font-size: 0.9em;
            margin-top: 5px;
        }
        #result {
            margin-top: 30px;
            padding: 20px;
            background-color: #e2e8f0; /* Fondo para el resultado */
            border-radius: 8px;
            min-height: 80px; /* Altura m√≠nima */
            display: flex;
            flex-wrap: wrap; /* Permite que los s√≠mbolos se envuelvan */
            justify-content: center; /* Centra los s√≠mbolos */
            align-items: center;
            gap: 10px; /* Espacio entre s√≠mbolos */
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05); /* Sombra interna */
        }
        #multiplicationResult {
            margin-top: 20px;
            padding: 15px;
            background-color: #d1fae5; /* Light green for multiplication result */
            border-radius: 8px;
            color: #065f46;
            font-weight: bold;
            display: none; /* Initially hidden */
        }
        .symbol-container {
            display: inline-block; /* Asegura que cada s√≠mbolo sea un bloque en l√≠nea */
            margin: 0 2px;
            vertical-align: middle;
        }
        img {
            width: 20%;
            height: 20%;
            object-fit: contain;
            display: inline-block;
        }

        .fallback-symbol {
            display: inline-flex;
            width: 50px;
            height: 50px;
            align-items: center;
            justify-content: center;
            background-color: #e5e7eb;
            color: #374151;
            font-weight: bold;
            border-radius: 0.25rem;
        }


        
        .form-label {
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
            color: #374151;
        }
        .form-input, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-us: 8px;
            font-size: 1rem;
            color: #1f2937;
            background-color: #f9fafb;
            transition: border-color 0.2s;
        }
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #3b82f6; /* Un azul bonito al enfocar */
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }
        .btn {
            background-color: #4f46e5; /* Morado intenso */
            color: white;
            padding: 14px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn:hover {
            background-color: #4338ca; /* Morado m√°s oscuro al pasar el rat√≥n */
            transform: translateY(-1px);
        }
        .btn:active {
            transform: translateY(0);
        }
        .message-box {
            padding: 12px 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-weight: 500;
            display: none; /* Oculto por defecto */
        }
        .message-box.success {
            background-color: #d1fae5; /* Verde claro */
            color: #065f46; /* Verde oscuro */
            border: 1px solid #10b981;
        }
        .message-box.error {
            background-color: #fee2e2; /* Rojo claro */
            color: #991b1b; /* Rojo oscuro */
            border: 1px solid #ef4444;
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #ffffff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: none; /* Oculto por defecto */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Estilos para las pesta√±as de navegaci√≥n principal */
        .main-tab-button {
            padding: 8px 15px; /* Reducido de 12px 20px */
            border-radius: 8px 8px 0 0;
            font-weight: 600;
            cursor: pointer;
            background-color: #e5e7eb; /* Gris claro */
            color: #4b5563;
            transition: background-color 0.2s, color 0.2s;
            white-space: nowrap; /* Evita que el texto se rompa */
            margin-right: 1%; /* Reducido de 10% para menor espacio entre pesta√±as */
            font-size: 0.9em; /* Reducir el tama√±o de la fuente */
        }
        .main-tab-button.active {
            background-color: #ffffff;
            color: #4f46e5; /* Morado */
            box-shadow: 0 -2px 0 0 #4f46e5 inset; /* Subrayado morado */
        }
        .main-tab-content {
            padding-top: 24px;
            border-top: 1px solid #e5e7eb;
        }

        /* Estilos para las sub-pesta√±as del diario */
        .diary-sub-tab-button {
            padding: 6px 12px; /* Reducido de 8px 16px */
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            background-color: #f3f4f6;
            color: #6b7280;
            transition: background-color 0.2s, color 0.2s;
            margin-right: 6px; /* Ajustado de 8px */
            font-size: 0.85em; /* Reducir el tama√±o de la fuente */
        }
        .diary-sub-tab-button.active {
            background-color: #e0e7ff; /* Azul claro */
            color: #4f46e5; /* Morado */
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .diary-sub-tab-content {
            padding-top: 16px;
        }

        .hidden {
            display: none !important;
        }
        .entry-card {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .entry-card img {
            max-width: 50%;
            height: auto;
            border-radius: 6px;
            margin-top: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }
        .entry-card img:hover {
            transform: scale(1.9);
        }
        
        /* Estilos para el modal de imagen */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 60%;
            height: 60%;
            background-color: rgba(0,0,0,0.8);
        }
        .modal-content {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            padding: 20px;
        }
        .modal-image {
            max-width: 90%;
            max-height: 90%;
            border-radius: 8px;
        }
        .close-modal {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-modal:hover {
            color: #ccc;
        }
        
        /* Indicador de carga para im√°genes */
        .image-loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        .radio-button {
  background: linear-gradient(to right, #6366f1, #8b5cf6);
  color: white;
  padding: 10px 20px;
  border-radius: 9999px;
  font-weight: bold;
  transition: all 0.2s;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}
.radio-button:hover {
  transform: scale(1.1);
  background: linear-gradient(to right, #4f46e5, #7c3aed);
}

        /* Nuevo estilo para el estado activo/presionado de los botones de radio */
.radio-button.active {
  background: linear-gradient(to right, #4338ca, #6d28d9); /* Un morado m√°s oscuro */
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3); /* Efecto hundido */
  transform: translateY(0); /* Asegura que no se eleve */
  color: white; /* Asegura que el texto permanezca blanco */
}

/* Modificaci√≥n para el hover cuando el bot√≥n est√° activo, para mantener el efecto hundido */
.radio-button.active:hover {
  background: linear-gradient(to right, #4338ca, #6d28d9); /* Mantiene el color oscuro */
  transform: translateY(0); /* Evita que se eleve */
}

.song-info-box {
  background-color: #f3f4f6;
  border: 2px solid #6366f1;
  padding: 12px 16px;
  border-radius: 12px;
  margin-bottom: 1rem;
  box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);
}
.song-info-title {
  font-weight: 700;
  color: #374151;
  font-size: 1rem;
}
.song-info-content {
  font-size: 1.2rem;
  color: #4f46e5;
}
.song-info-next {
  font-size: 0.9rem;
  color: #6b7280;
  font-style: italic;
  margin-top: 0.3rem;
}
        .drop-zone {
  border: 2px dashed #6366f1;
  padding: 20px;
  text-align: center;
  border-radius: 12px;
  cursor: pointer;
  transition: background 0.2s;
  color: #4f46e5;
}
.drop-zone:hover {
  background: #eef2ff;
}
        body > script:not([src]) {
  display: none;
}
        nav.flex {
  overflow-x: auto;
  white-space: nowrap;
  padding-bottom: 10px; /* Espacio para scroll */
  margin-right: 20px; /* Espacio al final */
}

        .main-tab-button {
  margin-right: 4%; /* Espacio entre pesta√±as */
  flex-shrink: 0; /* Evita que se compriman */
}

        #mainGraphSection {
  overflow: hidden;
}

#mainGraphSection iframe {
  display: block;
  position: relative;
  z-index: 1;
}

                #maintontoSection {
  overflow: hidden;
}

#maintontoSection iframe2 {
  display: block;
  position: relative;
  z-index: 1;
}
/* Oculta cualquier iframe dentro de secciones ocultas */
.main-tab-content.hidden iframe {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none;
      z-index: -1000 !important;
}

}
/* Oculta cualquier iframe dentro de secciones ocultas */
.main-tab-content.hidden iframe2 {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none;
      z-index: -1000 !important;
}



    ul {
      list-style: none;
      padding: 0;
    }
    li {
      margin-bottom: 10px;
      font-size: 18px;
    }
    .icon {
      margin-right: 10px;
    }




/* Estilos para las im√°genes dentro del contenido de las historias */
    /* Apunta a las im√°genes que est√°n dentro de un contenedor con la clase 'prose' */
    .prose img {
        width: 100%; /* Las im√°genes ocupar√°n el 100% del ancho de su contenedor */
        max-width: 300px; /* Limita el ancho m√°ximo para que no sean excesivamente grandes */
        height: auto; /* Mantiene la proporci√≥n de la imagen */
        display: block; /* Asegura que la imagen sea un bloque y no haya espacio extra debajo */
        margin-left: auto; /* Centra la imagen si es m√°s peque√±a que el contenedor */
        margin-right: auto; /* Centra la imagen si es m√°s peque√±a que el contenedor */
        transition: transform 0.3s ease-in-out; /* Suaviza la transici√≥n al hacer hover */
    }

    /* Efecto de hover para las im√°genes dentro del contenido de las historias */
    .prose img:hover {
        transform: scale(1.95); /* Aumenta ligeramente el tama√±o al pasar el rat√≥n (5%) */
    }

    /* Opcional: Si quieres que el efecto hover se active cuando el rat√≥n est√° sobre el contenedor de la historia */
    /* Esto es m√°s complejo ya que el 'prose' div est√° anidado. */
    /* Si el div con la clase 'entry-card' es el contenedor principal de la historia y el contenido se expande dentro de √©l. */
    .entry-card .prose img:hover {
        transform: scale(1.95);
    }




        
    </style>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
     <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 p-5 flex items-center justify-center min-h-screen">

    <!-- Modal para ver im√°genes en grande -->
    <div id="imageModal" class="modal">
        <span class="close-modal">&times;</span>
        <div class="modal-content">
            <img id="modalImage" class="modal-image" src="" alt="Imagen ampliada">
        </div>
    </div>

    <div class="container rounded-xl shadow-xl flex flex-col">
        <h1 class="text-4xl font-extrabold text-gray-900 mb-8 text-center">Javier Santiago Gast√≥n de Iriarte Cabrera</h1>

        <!-- Nueva pesta√±a en navegaci√≥n principal -->
        <nav class="flex border-b border-gray-200 -mt-8 mb-8 overflow-x-auto">
          <button class="main-tab-button" data-main-tab="home">Inicio</button>
          <button class="main-tab-button" data-main-tab="diary">Anotaciones</button>
                        <button class="main-tab-button" data-main-tab="stories">Stories</button>
                      <button class="main-tab-button" data-main-tab="profile">Perfil</button> <!-- Nueva pesta√±a -->
          <button class="main-tab-button" data-main-tab="radio">Radio</button>
            <button class="main-tab-button" data-main-tab="time-converter">Conversor de Tiempo</button>
             <button class="main-tab-button" data-main-tab="time-elapsed">Tiempo Transcurrido</button>
            <button class="main-tab-button" data-main-tab="number-symbols">Traductor de N√∫meros</button>
            <button class="main-tab-button" data-main-tab="graph">La Funci√≥n Mundo Azul</button>
            <button class="main-tab-button" data-main-tab="tonto">Corta Paluegos</button>


          <button class="main-tab-button" data-main-tab="maps">Mapas de Recorridos</button>
          <button class="main-tab-button" data-main-tab="trips">Organizar Viajes</button>
          <button class="main-tab-button" data-main-tab="menus">Men√∫s de Comida</button>
          <button class="main-tab-button" data-main-tab="projects">Proyectos</button>

            

        </nav>

        <div id="mainHomeSection" class="main-tab-content">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Bienvenido a mi p√°gina Personal</h2>
            <p class="text-center text-gray-600 mb-8"></p>
            <a href="https://jsgaston.github.io/" target="profile">
              <img src="perfil.jpg" alt="Perfil 29/7/2025">
            </a>
            <p class="text-center text-gray-600 mb-8"></p>
            <p class="text-center text-gray-600 mb-8">Explora las pesta√±as de arriba.</p>
            
            <h3 class="text-xl font-semibold text-gray-700 mb-4">√öltima entrada anotaciones:</h3>
            <div id="latestEntryContent" class="text-gray-700">
                <p class="text-center text-gray-500">Cargando √∫ltima entrada de las anotaciones...</p>
            </div>
            <div class="flex justify-center mt-8">
                <button onclick="showMainTab('diary'); showDiarySubTab('write')" class="btn py-3 px-6 rounded-lg text-lg">
                    <span>Ir al anotaciones</span>
                </button>
            </div>

            <hr class="my-6">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">√öltima Historia Publicada:</h3>
            <div id="latestStoryContent" class="text-gray-700">
                <p class="text-center text-gray-500">Cargando √∫ltima historia...</p>
            </div>

        </div>

        <div id="mainDiarySection" class="main-tab-content hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Notas R√°pidas</h2>
            
            <nav class="flex border-b border-gray-200 mb-6">
                <button class="diary-sub-tab-button active" data-diary-sub-tab="write">Escribir Entrada</button>
                <button class="diary-sub-tab-button" data-diary-sub-tab="view">Ver/Buscar Entradas</button>
            </nav>

            <div id="diaryWriteEntrySection" class="diary-sub-tab-content">
                <form id="diaryForm" class="w-full">
                    <div class="mb-6">
                      <label for="title" class="form-label mb-2">T√≠tulo de la Entrada:</label>
                      <input type="text" id="title" name="title" class="form-input rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Ej: Paseo por el parque" />
                    </div>
                    <div class="mb-6">
                        <label for="text" class="form-label mb-2">Tu Entrada de Hoy:</label>
                        <textarea id="text" name="text" rows="8" class="form-textarea rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="¬øQu√© te ha pasado hoy? Escribe aqu√≠ tu historia..."></textarea>
                    </div>

                    <div class="mb-4">
                          <label class="form-label mb-2">Arrastra una imagen aqu√≠ o haz clic para elegir:</label>
                          <div id="diaryDropZone" class="drop-zone">
                            Suelta tu imagen aqu√≠ o haz clic para seleccionarla
                            <input type="file" id="photoUpload" hidden accept="image/*" />
                          </div>
                          <p class="text-sm text-gray-500 mt-1">Se subir√° a tu Google Drive. Tama√±o m√°ximo: 5MB.</p>
                        </div>


                    <div class="mb-8">
                        <label for="externalImageUrl" class="form-label mb-2">
                          O pegar <strong>URL de imagen</strong> desde servicios como:
                        </label>
                        <div class="flex flex-wrap gap-2 mb-2">
                          <a href="https://es.imgbb.com/" target="_blank" class="text-blue-600 underline hover:text-blue-800">ImgBB</a>
                          <a href="https://pasteboard.co/" target="_blank" class="text-blue-600 underline hover:text-blue-800">Pasteboard</a>
                          <a href="https://postimages.org/" target="_blank" class="text-blue-600 underline hover:text-blue-800">Postimages</a>
                          <a href="https://imgur.com/" target="_blank" class="text-blue-600 underline hover:text-blue-800">Imgur</a>
                        </div>
                        
                        <input
                          type="url"
                          id="externalImageUrl"
                          name="externalImageUrl"
                          class="form-input rounded-lg focus:ring-blue-500 focus:border-blue-500"
                          placeholder="Ej: https://ibb.co/ABC123 o https://i.imgur.com/ejemplo.jpg"
                        />
                        <p class="text-sm text-gray-500 mt-1">Se procesar√° autom√°ticamente si es compatible.</p>

                    </div>

                    <div id="messageBox" class="message-box w-full"></div>

                    <button type="submit" class="btn w-full">
                        <span id="buttonText">Guardar Entrada</span>
                        <div id="loadingSpinner" class="loading-spinner"></div>
                    </button>
                </form>
            </div>

            <div id="diaryViewSearchSection" class="diary-sub-tab-content hidden">
                
                <div class="flex gap-2 items-end mb-6">
                  <div class="flex-1">
                    <label for="searchTitle" class="form-label mb-2">Buscar por T√≠tulo:</label>
                    <input type="text" id="searchTitle" name="searchTitle" class="form-input rounded-lg" placeholder="Palabra clave del t√≠tulo">
                  </div>
                  <button onclick="buscarPorTitulo()" class="btn px-6 py-3">Buscar</button>
                </div>

                <h3 class="text-xl font-semibold text-gray-700 mb-4">Buscar Entradas por Fecha</h3>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-8">
                    <div>
                        <label for="startDate" class="form-label">Desde:</label>
                        <input type="datetime-local" id="startDate" class="form-input w-auto">
                    </div>
                    <div>
                        <label for="endDate" class="form-label">Hasta:</label>
                        <input type="datetime-local" id="endDate" class="form-input w-auto">
                    </div>
                    <button id="searchEntriesBtn" class="btn mt-6 sm:mt-0 px-6 py-3">Buscar</button>
                </div>
                <div id="searchResults" class="text-gray-700">
                    <p class="text-center text-gray-500">Usa el filtro de fechas para buscar entradas.</p>
                </div>
            </div>
        </div>

        <div id="mainMapsSection" class="main-tab-content hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Mapas de Recorridos</h2>
            <!-- Sustituir el contenido del div con id="mainMapsSection" en tu HTML -->

            
              <div class="flex gap-4 mb-4">
                <input type="datetime-local" id="mapStartDate" class="form-input" value="2025-06-21T00:00">
                <input type="datetime-local" id="mapEndDate" class="form-input" value="2025-06-22T23:59">

                <button onclick="filtrarDatosMapa()" class="btn">Aplicar Filtros</button>
              </div>
            
              <div id="mapid" style="height: 500px;" class="mb-6 rounded-xl shadow-md"></div>
            
              <h3 class="text-xl font-semibold text-gray-700 mb-2">Datos Recopilados</h3>
              <div class="overflow-auto max-h-[400px] border rounded-lg shadow">
                <table class="w-full text-sm text-left">
                  <thead class="bg-gray-100">
                    <tr>
                      <th class="px-4 py-2">Fecha</th>
                      <th class="px-4 py-2">Hora</th>
                      <th class="px-4 py-2">Lat</th>
                      <th class="px-4 py-2">Lon</th>
                      <th class="px-4 py-2">Alt</th>
                      <th class="px-4 py-2">Pulso</th>
                      <th class="px-4 py-2">SpO2</th>
                      <th class="px-4 py-2">Pasos</th>
                      <th class="px-4 py-2">Temp</th>
                      <th class="px-4 py-2">Anomal√≠a</th>
                    </tr>
                  </thead>
                  <tbody id="tablaDatosMapa"></tbody>
                </table>
              </div>
          

        </div>

        <div id="mainTripsSection" class="main-tab-content hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Organizar Viajes</h2>
            <p class="text-center text-gray-600">Planifica tus viajes, rutas y presupuestos. ¬°Pr√≥ximamente!</p>
            <p class="text-center text-gray-500 mt-4">Puedes a√±adir formularios y listas para gestionar tus planes de viaje.</p>
        </div>

        <div id="mainMenusSection" class="main-tab-content hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Men√∫s de Comida</h2>
            <p class="text-center text-gray-600">Organiza tus comidas semanales y listas de la compra. ¬°Paciencia, pronto estar√° listo!</p>
            <p class="text-center text-gray-500 mt-4">Aqu√≠ podr√≠as tener un calendario, recetas y opciones de filtrado.</p>
        </div>

        <div id="mainProjectsSection" class="main-tab-content hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Gesti√≥n de Proyectos</h2>
            <p class="text-center text-gray-600">Gestiona tus tareas, plazos y objetivos de tus proyectos personales o profesionales. ¬°Trabajando en ello!</p>
            <p class="text-center text-gray-500 mt-4">Tableros Kanban o listas de tareas ser√≠an √∫tiles aqu√≠.</p>
        </div>

        <!-- Nueva secci√≥n "Perfil" -->
        <div id="mainProfileSection" class="main-tab-content hidden">
          <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Perfil Personal</h2>
          <div class="space-y-4">
            <p><strong>Nombre:</strong> Javier Santiago Gast√≥n de Iriarte Cabrera</p>
            <p><strong>DNI:</strong> 47033535F</p>
            <p><strong>Contacto:</strong> <a href="mailto:javier@email.com" class="text-blue-600 underline">jsgastoniriartecabrera@gmail.com</a></p>
            <p><strong>Tel√©fono:</strong> +34 669 574 483</p>
            <p><strong>Direcci√≥n:</strong> Ab el Hamet 4-6, esc. der, 1¬∫F, Alicante, 03003, Alicante, SPAIN</p>
            <p><strong>Sobre m√≠:</strong> Soy javi, ahora mismo tengo 42 a√±os Gregorianos, pero deber√≠a tener 25. Mi mujer y yo tenemos una pareja de hermanos gemelos malvados que nos han hecho perder 250000 soles a cada uno y siguen y siguen.</p>
              <p><strong></strong> </p>
              <p><strong></strong> </p>
              <p><strong></strong> </p>
              <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://jsgaston.github.io/" alt="QR de Javi">

          </div>
        </div>




        
        <!-- Secci√≥n de Radio -->
       <div id="mainRadioSection" class="main-tab-content hidden">
    <h2 class="text-3xl font-extrabold text-gray-900 mb-6 text-center">üéß Mi Radio Personal</h2>

    <div class="song-info-box text-center mb-6">
        <div class="song-info-title">üéµ Sonando ahora:</div>
        <div id="currentSong" class="song-info-content">---</div>
        <div id="nextSong" class="song-info-next">Siguiente: ---</div>
    </div>

    <div class="flex justify-center w-full px-4 mb-8">
        <audio id="audio" controls class="w-full max-w-2xl p-2 bg-white rounded-xl shadow-lg"></audio>
    </div>

    <div class="bg-indigo-50 p-6 rounded-xl shadow-md mb-8">
        <h3 class="text-xl font-bold text-indigo-800 mb-4 text-center">Controles de Reproducci√≥n</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 justify-items-center">
            <button onclick="prevTrack(); toggleActiveClass(this, false)" class="radio-button">‚èÆÔ∏è Anterior</button>
            <button onclick="nextTrack(); toggleActiveClass(this, false)" class="radio-button">‚è≠Ô∏è Siguiente</button>
            <button id="shuffleBtn" onclick="toggleShuffle(); toggleActiveClass(this, true)" class="radio-button">üîÄ Shuffle</button>
            <button id="repeatBtn" onclick="toggleRepeat(); toggleActiveClass(this, true)" class="radio-button">üîÅ Repeat</button>
        </div>
    </div>

    <div class="bg-blue-50 p-6 rounded-xl shadow-md mb-8">
        <h3 class="text-xl font-bold text-blue-800 mb-4 text-center">Opciones de Ordenaci√≥n</h3>
        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 justify-items-center">
            <button onclick="ordenarPor('artist'); toggleActiveClass(this, false, 'sort-button')" class="radio-button sort-button">Ordenar por Artista</button>
            <button onclick="ordenarPor('title'); toggleActiveClass(this, false, 'sort-button')" class="radio-button sort-button">Ordenar por T√≠tulo</button>
            <button onclick="ordenarPor('album'); toggleActiveClass(this, false, 'sort-button')" class="radio-button sort-button">Ordenar por √Ålbum</button>
            <button onclick="ordenarPor('genre'); toggleActiveClass(this, false, 'sort-button')" class="radio-button sort-button">Ordenar por G√©nero</button>
            <button onclick="ordenarPor('duration'); toggleActiveClass(this, false, 'sort-button')" class="radio-button sort-button">Ordenar por Duraci√≥n</button>
            <button onclick="mezclarCanciones(); toggleActiveClass(this, false, 'sort-button')" class="radio-button sort-button">Mezclar Aleatorio</button>
        </div>
    </div>

    <div class="bg-green-50 p-6 rounded-xl shadow-md mb-8">
        <h3 class="text-xl font-bold text-green-800 mb-4 text-center">Filtros</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label for="filterGenre" class="form-label mb-2">Filtrar por g√©nero:</label>
                <select id="filterGenre" class="form-input rounded-lg px-4 py-2" onchange="filtrarPorGenero()">
                    <option value="">Todos los g√©neros</option>
                </select>
            </div>
            <div>
                <label for="filterArtist" class="form-label mb-2">Filtrar por artista:</label>
                <select id="filterArtist" class="form-input rounded-lg px-4 py-2" onchange="filtrarPorArtista()">
                    <option value="">Todos los artistas</option>
                </select>
            </div>
        </div>
    </div>

    <div class="text-center mb-6">
        <button onclick="obtenerLetraDesdeAppScript()" class="radio-button">üìú Ver Letra</button>
    </div>
    
    <div id="letraCancion" class="mt-4 p-5 rounded-xl bg-white text-base text-gray-800 whitespace-pre-line shadow-lg hidden relative border border-gray-200">
        <button onclick="document.getElementById('letraCancion').classList.add('hidden')" 
                class="absolute top-3 right-3 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-lg hover:bg-red-600 focus:outline-none">
          &times;
        </button>
        <div id="letraTexto" class="max-h-96 overflow-y-auto pr-2"></div>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-md mb-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">Lista de Canciones</h3>
        <ul id="songList" class="list-disc px-6 text-left text-gray-800 space-y-2 max-h-80 overflow-y-auto"></ul>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-md mb-8 text-center">
        <label for="fullSongSelect" class="block mb-3 font-semibold text-gray-700 text-lg">Seleccionar canci√≥n de la lista completa:</label>
        <select id="fullSongSelect" class="form-input w-full max-w-md mx-auto rounded-md border border-gray-300 px-4 py-2">
            <option disabled selected>-- Elegir canci√≥n --</option>
        </select>
    </div>
           
<h2 class="text-2xl font-bold text-gray-800 mb-6 text-center"></h2>
           
    <div id="dropZone" class="drop-zone border-2 border-dashed border-purple-400 bg-purple-50 hover:bg-purple-100 p-8 rounded-xl text-purple-700 transition-all cursor-pointer mb-8">
        Arrastra tu canci√≥n aqu√≠ o haz clic para elegir
        <input type="file" id="uploader" hidden accept="audio/*">
    </div>

    <p id="resultado" class="text-center text-gray-600"></p>
</div>








  <!-- -Seccion conversor de unidades de tiempo -->

        <!-- -Seccion conversor de unidades de tiempo -->
<div id="mainTimeConverterSection" class="main-tab-content hidden">
   
    


    <div class="mt-8 bg-gray-50 p-4 rounded-lg">
        <h3 class="text-lg font-semibold mb-2">Definici√≥n de unidad de tiempo:</h3>
        <p class="text-center text-gray-600 mb-8"> Regla para contar tiempo: </p>
        <p class="text-center text-gray-600 mb-8"> Usas dos chapas o monedas planas de diferentes tama√±os y no trucadas...</p> 
        <p class="text-center text-gray-600 mb-8"> La altura: </p>
                              <p class="text-center text-gray-600 mb-8">      La altura minima donde al dejar esas monedas caer y las monedas puedan cambiar de lado de cara (la moneda la dejas caer plana) inicial es la altura para la medida del tiempo.</p>
                            <p class="text-center text-gray-600 mb-8">   </p>
                        <p class="text-center text-gray-600 mb-8">  Establecia la ultura, cuenta el tiempo en segundos (que es la unidad de tiempo que se usa en mi mundo, los relojes funcionan en segundos y abjao est√°n los cambios, y se cuenta el tiempo en recoger la moneda,  levantar la moneda a esa altura y dejar caer la moneda plana, y se repite lo mismo una vez la moneda est√° parada lo m√°s r√°pido posible, en suelo plano, de madera y lejos metales o imanes que puedan interferir</p>
                        <p class="text-center text-gray-600 mb-8">   </p>
                        <p class="text-center text-gray-600 mb-8">   Mi mejor marca fueron 10 tiradas completas (la ultima tirada se detuvo y par√© el contador de tiempo) en m√°s de 19 segundos, as√≠ que por convenio he estipulado que en menos de 17 segundos no lo podr√≠a lograr.</p>
                
                        <h3 class="text-lg font-semibold mb-2">Equivalencias:</h3>
        <ul class="list-disc pl-5 space-y-1">
            <li>10 tiradas = 17 segundos</li>
            <li>1 :-_ = 0.432 segundos</li>
            <li>1 tirada ‚âà 3.935 unidades peque√±as ( :-_ )</li>
            <li>1 o = 1 dia </li>
            <li>1 o = 20 : </li>
            <li>1 : = 100 :-</li>
            <li>1 :- = 100 :-_</li>
            <li>1 d√≠a = 24 horas</li>
            <li>1 hora = 60 minutos</li>
            <li>1 minuto = 60 segundos</li>
            <li>1 a√±o = 365.25 d√≠as</li>
        </ul>
    </div>



    

     <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Conversor de Unidades de Tiempo</h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
            <label for="fromValue" class="form-label mb-2">Valor (parte entera):</label>
            <input type="number" id="fromValue" class="form-input rounded-lg" placeholder="Ingresa el valor" step="any">
        </div>
        
        <div>
            <label for="fromUnit" class="form-label mb-2">De:</label>
            <select id="fromUnit" class="form-input rounded-lg">
            <option value="segundos">Segundos</option>
            <option value="minutos">Minutos</option>
            <option value="horas">Horas</option>
            <option value="dias">D√≠as</option>
            <option value="a√±os">A√±os</option>
            <option value=":-_">:-_ (Porciones peque√±as del sol)</option>
            <option value=":-">:- (Porciones medianas del sol)</option>
            <option value=":">: (Porciones grandes del sol)</option>
            <option value="o">o (Soles)</option>
            <option value="tiradas">Tiradas</option>
        </select>
        </div>
    </div>



        <div>
                <label for="toUnit" class="form-label mb-2">A:</label>
               <select id="toUnit" class="form-input rounded-lg">
            <option value=":-_">:-_ (Porciones peque√±as del sol)</option>
            <option value=":-">:- (Porciones medianas del sol)</option>
            <option value=":">: (Porciones grandes del sol)</option>
            <option value="o">o (Soles)</option>
            <option value="tiradas">Tiradas</option>
            <option value="segundos">Segundos</option>
            <option value="minutos">Minutos</option>
            <option value="horas">Horas</option>
            <option value="dias">D√≠as</option>
            <option value="a√±os">A√±os</option>
        </select>
    </div>
    
    <div>
        <label for="toValue" class="form-label mb-2">Resultado:</label>
        <input type="number" id="toValue" class="form-input rounded-lg bg-gray-100" readonly>
    </div>

    <button onclick="convertTime()" class="btn w-full">Convertir</button>



    
</div> <!-- Este es el </div> que cierra mainTimeConverterSection -->


        <!--  Fin secci√≥n convertidor unidades tiempo -->


























        
  


        <!--  Secci√≥n para Historias -->
        <div id="mainStoriesSection" class="main-tab-content hidden">
              <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Mis Historias</h2>
            
              <input type="text" id="storyTitle" placeholder="T√≠tulo de la historia" class="form-input mb-4">
              <div id="storyEditor" style="height: 300px;" class="mb-4 border border-gray-300 rounded-md p-4 bg-white"></div>
            
              <button class="btn" onclick="guardarHistoria()">Guardar Historia</button>
              <div id="storyMessage" class="message-box mt-4 hidden"></div>
            
              <hr class="my-6">
            
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Buscar Historias</h3>
            <div class="flex flex-col md:flex-row md:items-end gap-4 mb-6">
              <div class="flex-1">
                <label for="searchKeyword" class="form-label">Buscar por palabra clave:</label>
                <input type="text" id="searchKeyword" class="form-input rounded-lg" placeholder="Escribe una palabra del t√≠tulo o contenido">
              </div>
              <div>
                <label for="searchStartDate" class="form-label">Desde:</label>
                <input type="date" id="searchStartDate" class="form-input">
              </div>
              <div>
                <label for="searchEndDate" class="form-label">Hasta:</label>
                <input type="date" id="searchEndDate" class="form-input">
              </div>
              <div>
                <button onclick="buscarHistorias()" class="btn">üîç Buscar</button>
              </div>
            </div>
            
            <div id="searchStoryResults">
              <p class="text-center text-gray-500">Usa el buscador para encontrar historias.</p>
            </div>
            
            <hr class="my-6">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Historias Guardadas</h3>
            <div id="storyList"></div>
        
        
        
        </div>



        


<div id="mainTimeElapsedSection" class="main-tab-content hidden">
  <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Tiempo Transcurrido</h2>
  

        <h1>Calculadora de Tiempos</h1>

        <div class="form-group">
            <label for="startElapsed">Fecha de Inicio:</label>
            <input type="datetime-local" id="startElapsed" value="1982-12-06T00:00">
        </div>

        <div class="form-group">
            <label for="endElapsed">Fecha Fin:</label>
            <input type="datetime-local" id="endElapsed">
        </div>

        <div class="form-group">
            <label for="personasCeldaInput">Personas en Celda:</label>
            <input type="number" id="personasCeldaInput" value="16">
        </div>

        <div class="form-group">
            <label for="personasAfectadasInput">Personas Afectadas:</label>
            <input type="number" id="personasAfectadasInput" value="608">
        </div>

        <button onclick="updateElapsedTime()">Calcular</button>

        <div id="resultDisplay">
            <p>Haz clic en "Calcular" para ver los resultados.</p>
        </div>
 


    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center"></h2>


  <div class="bg-gray-50 p-4 rounded-lg text-center text-gray-800 space-y-3">
    <div><strong>Tiempo:</strong> <span id="elapsedDaysText">Calculando...</span></div>
    <div><strong>Total en Years (years):</strong> <span id="elapsedYears">...</span> <strong> years</strong> </div>
    <div><strong>Total en h (horas):</strong> <span id="elapsedHours">...</span><strong> h </strong></div>
    <div><strong>Total en m (minutos):</strong> <span id="elapsedMinutes">...</span><strong> m </strong></div>
    <div><strong>Total en s (segundos):</strong> <span id="elapsedSeconds">...</span><strong> s </strong></div>
  </div>


    
</div>



        




        



<!-- Secci√≥n Traductor de N√∫meros -->
<div id="mainNumberSymbolsSection" class="main-tab-content hidden">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Traductor de N√∫meros a S√≠mbolos</h2>
    
    <div class="mb-4">
        <img id="languageHeader" src="UniversalSistemNumbers/cabeza de p√°gina.jpg" alt="Encabezado del lenguaje" 
             style="max-height: 50px; display: block; margin: 0 auto;">
    </div>
    
    <div class="mb-6">
        <label for="numberInput" class="form-label mb-2">N√∫mero a traducir (S√≥lo parte entera):</label>
        <input type="text" id="numberInput" class="form-input rounded-lg" placeholder="Ej: 12345" oninput="sanitizeNumberInput(this)">
    </div>
    
    <button onclick="translateNumber()" class="btn w-full mb-6">Traducir</button>
    
    <div id="symbolsResult" style="background-color: #f3f4f6; border-radius: 0.5rem; padding: 1rem; min-height: 80px; overflow-x: auto; white-space: nowrap; text-align: center;">
        <p style="color: #6b7280; text-align: center; width: 100%;">Ingresa un n√∫mero para ver su representaci√≥n en s√≠mbolos</p>
    </div>
</div>



 <!-- A√±adir esta nueva secci√≥n al final, antes del cierre del div container -->
<div id="mainGraphSection" class="main-tab-content hidden">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Gr√°fica de la Funci√≥n Mundo Azul</h2>

    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center"></h2>

      <h2>üåà Resultados del Juego y Nacimientos</h2>
  <ul>
    <li><i class="fas fa-flag icon" style="color:blue;"></i>Si ganan los Azules, nacen <strong>Azules</strong> üü¶</li>
    <li><i class="fas fa-handshake icon" style="color:gray;"></i>Si empatan los Azules y los Rojos, nacen <strong>Azules</strong> üü¶</li>
    <li><i class="fas fa-flag icon" style="color:red;"></i>Si ganan los Rojos, nacen <strong>Azules</strong> üü¶ y <strong>Rojos</strong> üü•</li>
  </ul>


    
    <iframe src="funcion.html" style="width:100%; height:600px; border:none; border-radius:12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);" allowfullscreen></iframe>
</div>




 <!-- A√±adir esta nueva secci√≥n al final, antes del cierre del div container -->
<div id="maintontoSection" class="main-tab-content hidden">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Corta Paluegos Regulero</h2>
    <iframe src="Roomba_93.html" style="width:100%; height:600px; border:none; border-radius:12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);" allowfullscreen></iframe>
</div>












        







      

                    



        


            

    </div>
    <script>
        // ¬°IMPORTANTE! Reemplaza este URL con el URL de tu Google Apps Script desplegado.
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbykJTypKfvu-NyjwspsAGIxjYqEz0vGfBq-Si5wx4HFgG-5wEIXRD4159yIOVuaVHw8cg/exec'; 

        // Elementos del DOM para la navegaci√≥n principal
        const mainTabButtons = document.querySelectorAll('.main-tab-button');
        const mainHomeSection = document.getElementById('mainHomeSection');
        const mainDiarySection = document.getElementById('mainDiarySection');
        const mainMapsSection = document.getElementById('mainMapsSection');
        const mainTripsSection = document.getElementById('mainTripsSection');
        const mainMenusSection = document.getElementById('mainMenusSection');
        const mainProjectsSection = document.getElementById('mainProjectsSection');

        // Elementos del DOM para la sub-navegaci√≥n del Diario
        const diarySubTabButtons = document.querySelectorAll('.diary-sub-tab-button');
        const diaryWriteEntrySection = document.getElementById('diaryWriteEntrySection');
        const diaryViewSearchSection = document.getElementById('diaryViewSearchSection');

        // Elementos del DOM para la l√≥gica del Diario
        const latestEntryContent = document.getElementById('latestEntryContent');
        const searchEntriesBtn = document.getElementById('searchEntriesBtn');
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const searchResultsDiv = document.getElementById('searchResults');
        const diaryForm = document.getElementById('diaryForm');
        const text = document.getElementById('text');
        const photoUpload = document.getElementById('photoUpload');
        const externalImageUrlInput = document.getElementById('externalImageUrl');
        const messageBox = document.getElementById('messageBox');
        const buttonText = document.getElementById('buttonText');
        const loadingSpinner = document.getElementById('loadingSpinner');

        // Elementos del modal
        const imageModal = document.getElementById('imageModal');
        const modalImage = document.getElementById('modalImage');
        const closeModal = document.querySelector('.close-modal');

        const graphSection = document.getElementById('mainGraphSection');
        const tontoSection = document.getElementById('maintontoSection');



text.addEventListener('paste', function (event) {
    const items = (event.clipboardData || event.originalEvent.clipboardData).items;
    for (const item of items) {
        if (item.type.indexOf("image") !== -1) {
            const file = item.getAsFile();
            const reader = new FileReader();
            reader.onload = function (evt) {
                // ‚úÖ Pegamos la imagen base64 en un campo oculto
                document.getElementById('externalImageUrl').value = ''; // evitar conflicto
                window._diaryPastedImage = evt.target.result;
                showMessage("Imagen pegada desde el portapapeles (se subir√° al guardar).", "success");
            };
            reader.readAsDataURL(file);
        }
    }
});

const diaryDropZone = document.getElementById("diaryDropZone");

// Abrir selector de archivos al hacer clic
diaryDropZone.addEventListener("click", () => photoUpload.click());

// Cambiar estilo al arrastrar
diaryDropZone.addEventListener("dragover", e => {
  e.preventDefault();
  diaryDropZone.style.background = "#ddd6fe";
});
diaryDropZone.addEventListener("dragleave", () => {
  diaryDropZone.style.background = "";
});

// Manejar el drop
diaryDropZone.addEventListener("drop", e => {
  e.preventDefault();
  diaryDropZone.style.background = "";
  const files = e.dataTransfer.files;
  if (files.length > 0) {
    photoUpload.files = files;
    showMessage("üì§ Imagen cargada desde drag & drop.", "success");
  }
});



        

        // --- Funciones de Utilidad ---

        // Funci√≥n para mostrar mensajes al usuario (√©xito/error)
        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.className = `message-box w-full ${type}`;
            messageBox.style.display = 'block';
        }

        // Funci√≥n para ocultar mensajes
        function hideMessage() {
            messageBox.style.display = 'none';
            messageBox.textContent = '';
            messageBox.className = 'message-box w-full';
        }

        // Funci√≥n auxiliar para leer un archivo como Base64
        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        // Funci√≥n para resetear el estado del formulario
        function resetFormState() {
            buttonText.textContent = 'Guardar Entrada';
            loadingSpinner.style.display = 'none';
            diaryForm.querySelector('button[type="submit"]').disabled = false;
        }



        /**
 * Toggles an 'active' class on a button and manages active state for groups.
 * @param {HTMLElement} buttonElement The button element to toggle.
 * @param {boolean} isToggle Whether the button acts as a simple toggle (like shuffle/repeat) or part of a mutually exclusive group (like sort options).
 * @param {string} [groupClass] Optional. A class to identify buttons in a mutually exclusive group (e.g., 'sort-button').
 */
function toggleActiveClass(buttonElement, isToggle, groupClass = null) {
    if (isToggle) {
        // For toggle buttons (like shuffle/repeat), just switch active state
        buttonElement.classList.toggle('active');
    } else {
        // For mutually exclusive groups (like sort options)
        if (groupClass) {
            // Deactivate all other buttons in the same group
            document.querySelectorAll(`.${groupClass}`).forEach(btn => {
                if (btn !== buttonElement) {
                    btn.classList.remove('active');
                }
            });
        }
        // Toggle active state for the clicked button
        buttonElement.classList.toggle('active');
    }
}

// Initial setup: You might want to call this function on page load if certain buttons
// should be active by default, for example, if shuffle is initially on:
// document.addEventListener('DOMContentLoaded', () => {
//     const shuffleBtn = document.getElementById('shuffleBtn');
//     if (shuffleBtn && someGlobalShuffleStateIsTrue) { // Replace 'someGlobalShuffleStateIsTrue' with your actual logic
//         shuffleBtn.classList.add('active');
//     }
// });







        

        // Funci√≥n para formatear la fecha
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            try {
                return new Date(dateString).toLocaleDateString('es-ES', options);
            } catch (e) {
                return dateString;
            }
        }

        // Funci√≥n mejorada para convertir URLs de servicios de hosting a URLs directas (cliente)
        function convertToDirectImageUrl(url) {
            if (!url || url.trim() === '') return null;
        
            const cleanUrl = url.trim();
        
            // Si ya es directa, √∫sala
            if (cleanUrl.match(/\.(jpg|jpeg|png|gif|webp)(\?.*)?$/i) ||
                cleanUrl.includes('drive.google.com/thumbnail') ||
                cleanUrl.includes('i.ibb.co') ||
                cleanUrl.includes('i.imgur.com') ||
                cleanUrl.includes('i.postimg.cc')) {
                return cleanUrl;
            }
        
            // pasteboard.co
            const pasteboard = cleanUrl.match(/pasteboard\.co\/([a-zA-Z0-9]+)(\.[a-z]+)?/);
            if (pasteboard) {
                return `https://pasteboard.co/${pasteboard[1]}.png`;
            }
        
            // imgbb
            const imgbb = cleanUrl.match(/ibb\.co\/([a-zA-Z0-9]+)/);
            if (imgbb) {
                return `https://i.ibb.co/${imgbb[1]}/image.png`;
            }
        
            // imgur
            const imgur = cleanUrl.match(/imgur\.com\/(?:a\/)?([a-zA-Z0-9]+)/);
            if (imgur) {
                return `https://i.imgur.com/${imgur[1]}.jpg`;
            }
        
            // postimages
            const postimg = cleanUrl.match(/postimg\.cc\/([a-zA-Z0-9]+)/);
            if (postimg) {
                return `https://i.postimg.cc/${postimg[1]}/image.jpg`;
            }
        
            return cleanUrl;
        }
        


        // Funci√≥n para intentar m√∫ltiples URLs de imagen
        function tryMultipleImageUrls(originalUrl, imgElement, callback) {
            const urls = [];
        
            const directUrl = convertToDirectImageUrl(originalUrl);
            if (directUrl) urls.push(directUrl);
        
            // Agregar variantes por host
            const imgbb = originalUrl.match(/ibb\.co\/([a-zA-Z0-9]+)/);
            if (imgbb) {
                const base = `https://i.ibb.co/${imgbb[1]}`;
                urls.push(`${base}/image.png`, `${base}/image.jpg`, `${base}/image.webp`);
            }
        
            const pasteboard = originalUrl.match(/pasteboard\.co\/([a-zA-Z0-9]+)/);
            if (pasteboard) {
                const base = `https://pasteboard.co/${pasteboard[1]}`;
                urls.push(`${base}.png`, `${base}.jpg`, `${base}.webp`);
            }
        
            const imgur = originalUrl.match(/imgur\.com\/(?:a\/)?([a-zA-Z0-9]+)/);
            if (imgur) {
                urls.push(`https://i.imgur.com/${imgur[1]}.jpg`);
            }
        
            const postimg = originalUrl.match(/postimg\.cc\/([a-zA-Z0-9]+)/);
            if (postimg) {
                const base = `https://i.postimg.cc/${postimg[1]}`;
                urls.push(`${base}/image.jpg`, `${base}/image.png`, `${base}/image.webp`);
            }
        
            let index = 0;
        
            function tryNextUrl() {
                if (index >= urls.length) {
                    callback(false); // ninguna funcion√≥
                    return;
                }
        
                const testUrl = urls[index];
                const testImg = new Image();
                testImg.onload = () => {
                    imgElement.src = testUrl;
                    callback(true);
                };
                testImg.onerror = () => {
                    index++;
                    tryNextUrl();
                };
                testImg.src = testUrl;
            }
        
            tryNextUrl();
        }


        

        // Funci√≥n para renderizar una entrada de diario con mejor manejo de im√°genes
        function renderEntry(entry, containerElement) {
                        
            const entryCard = document.createElement('div');
            entryCard.className = 'entry-card';

            const titleElem = document.createElement('h3');
            titleElem.className = 'text-xl font-bold text-indigo-700 mb-2';
            titleElem.textContent = entry.title || '(Sin t√≠tulo)';
            entryCard.appendChild(titleElem);


            const datePara = document.createElement('p');
            datePara.className = 'text-sm text-gray-500 mb-2';
            datePara.textContent = `Fecha: ${formatDate(entry.timestamp)}`;
            entryCard.appendChild(datePara);

            const textPara = document.createElement('p');
            textPara.className = 'text-base text-gray-800 whitespace-pre-wrap';
            textPara.textContent = entry.text;
            entryCard.appendChild(textPara);

            // Verificar si hay una URL de foto v√°lida
            if (entry.photoUrl && entry.photoUrl !== 'No hay foto' && !entry.photoUrl.startsWith('Error')) {
                const imageContainer = document.createElement('div');
                imageContainer.className = 'mt-4';
                
                const loadingIndicator = document.createElement('div');
                loadingIndicator.innerHTML = '<span class="image-loading"></span>Cargando imagen...';
                loadingIndicator.className = 'text-sm text-gray-500 flex items-center';
                imageContainer.appendChild(loadingIndicator);
                
                const img = document.createElement('img');
                img.className = 'mt-4 rounded-lg shadow-md hidden';
                img.alt = 'Foto de la entrada del diario';
                
                // A√±adir evento de clic para mostrar en modal
                img.addEventListener('click', function() {
                    modalImage.src = this.src;
                    imageModal.style.display = 'block';
                });
                
                imageContainer.appendChild(img);
                entryCard.appendChild(imageContainer);
                
                // Intentar cargar la imagen con m√∫ltiples URLs si es necesario
                tryMultipleImageUrls(entry.photoUrl, img, function(success) {
                    loadingIndicator.style.display = 'none';
                    if (success) {
                        img.classList.remove('hidden');
                    } else {
                        const errorPara = document.createElement('p');
                        errorPara.className = 'text-sm text-red-500 mt-2';
                        errorPara.textContent = 'No se pudo cargar la imagen';
                        imageContainer.appendChild(errorPara);
                    }
                });
                
            } else if (entry.photoUrl && entry.photoUrl.startsWith('Error')) {
                const errorPara = document.createElement('p');
                errorPara.className = 'text-sm text-red-500 mt-2';
                errorPara.textContent = `Error con la foto: ${entry.photoUrl}`;
                entryCard.appendChild(errorPara);
            }

            containerElement.appendChild(entryCard);
        }

        // Event listeners para el modal
        closeModal.addEventListener('click', function() {
            imageModal.style.display = 'none';
        });

        imageModal.addEventListener('click', function(e) {
            if (e.target === imageModal) {
                imageModal.style.display = 'none';
            }
        });

        // --- Funciones de Navegaci√≥n Principal ---
let graphIframeSrc = 'funcion.html';
let graphIframe = null;

        let graphIframe2Src = 'Roomba_93.html';
let graphIframe2 = null;
        
function showMainTab(tabName) {
    // Ocultar todas las secciones
    mainHomeSection.classList.add('hidden');
    mainDiarySection.classList.add('hidden');
    mainMapsSection.classList.add('hidden');
    mainTripsSection.classList.add('hidden');
    mainMenusSection.classList.add('hidden');
    mainProjectsSection.classList.add('hidden');
    document.getElementById('mainProfileSection').classList.add('hidden');
    document.getElementById('mainRadioSection').classList.add('hidden');
    document.getElementById('mainStoriesSection').classList.add('hidden');
    document.getElementById('mainTimeConverterSection').classList.add('hidden');
    document.getElementById('mainTimeElapsedSection').classList.add('hidden');
    document.getElementById('mainNumberSymbolsSection').classList.add('hidden');
    document.getElementById('mainGraphSection').classList.add('hidden'); // Asegurarse de ocultar
    document.getElementById('maintontoSection').classList.add('hidden'); // Asegurarse de ocultar
    
    // Eliminar el div extra si existe
    const extraTimeUnits = document.getElementById('extraTimeUnits');
    if (extraTimeUnits) {
        extraTimeUnits.remove();
    }

    // Activar la pesta√±a correspondiente
    mainTabButtons.forEach(button => button.classList.remove('active'));

    // Mostrar la secci√≥n correspondiente
    if (tabName === 'home') {
        mainHomeSection.classList.remove('hidden');
        document.querySelector('[data-main-tab="home"]').classList.add('active');
        loadLatestEntry();
        loadLatestStory();
    } else if (tabName === 'diary') {
        mainDiarySection.classList.remove('hidden');
        document.querySelector('[data-main-tab="diary"]').classList.add('active');
        showDiarySubTab('write');
    } else if (tabName === 'maps') {
        mainMapsSection.classList.remove('hidden');
        document.querySelector('[data-main-tab="maps"]').classList.add('active');
        setTimeout(() => {
            if (!mapa) iniciarMapa(); else mapa.invalidateSize();
        }, 300);
    } else if (tabName === 'trips') {
        mainTripsSection.classList.remove('hidden');
        document.querySelector('[data-main-tab="trips"]').classList.add('active');
    } else if (tabName === 'menus') {
        mainMenusSection.classList.remove('hidden');
        document.querySelector('[data-main-tab="menus"]').classList.add('active');
    } else if (tabName === 'projects') {
        mainProjectsSection.classList.remove('hidden');
        document.querySelector('[data-main-tab="projects"]').classList.add('active');
    } else if (tabName === 'profile') {
        document.getElementById('mainProfileSection').classList.remove('hidden');
        document.querySelector('[data-main-tab="profile"]').classList.add('active');
    } else if (tabName === 'radio') {
        document.getElementById('mainRadioSection').classList.remove('hidden');
        document.querySelector('[data-main-tab="radio"]').classList.add('active');
    } else if (tabName === 'stories') {
        document.getElementById('mainStoriesSection').classList.remove('hidden');
        document.querySelector('[data-main-tab="stories"]').classList.add('active');
        cargarHistorias();
    } else if (tabName === 'time-converter') {
        document.getElementById('mainTimeConverterSection').classList.remove('hidden');
        document.querySelector('[data-main-tab="time-converter"]').classList.add('active');
    } else if (tabName === 'number-symbols') {
        document.getElementById('mainNumberSymbolsSection').classList.remove('hidden');
        document.querySelector('[data-main-tab="number-symbols"]').classList.add('active');
    } else if (tabName === 'graph') {
        document.getElementById('mainGraphSection').classList.remove('hidden');
        document.querySelector('[data-main-tab="graph"]').classList.add('active');

        } else if (tabName === 'tonto') {
        document.getElementById('maintontoSection').classList.remove('hidden');
        document.querySelector('[data-main-tab="tonto"]').classList.add('active');
    
    
    } else if (tabName === 'time-elapsed') {
        document.getElementById('mainTimeElapsedSection').classList.remove('hidden');
        document.querySelector('[data-main-tab="time-elapsed"]').classList.add('active');
        // Prellenar fecha final si est√° vac√≠a
        const endInput = document.getElementById("endElapsed");
        if (!endInput.value) {
            const now = new Date();
            // Ajustar 2 horas para horario de verano en Espa√±a (UTC+2)
            const madridTime = new Date(now.getTime() + 2 * 60 * 60 * 1000);
            endInput.value = madridTime.toISOString().slice(0,16);
        }
        updateElapsedTime();
    }

   


    hideMessage();
}
    
            // Event listeners para los botones de las pesta√±as principales
            mainTabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    showMainTab(button.dataset.mainTab);
                });
            });


        function loadGraphIframe() {
            const container = document.getElementById('graphIframeContainer');
            if (!container) return;
            
            // Crear el iframe
            graphIframe = document.createElement('iframe');
            graphIframe.src = 'funcion.html';
            graphIframe.allowFullscreen = true;
            
            // Agregar al contenedor
            container.appendChild(graphIframe);
            graphIframeLoaded = true;
            
            // Manejar errores
            graphIframe.addEventListener('error', () => {
                container.innerHTML = '<p class="text-center p-4 text-red-500">Error al cargar la gr√°fica</p>';
            });
        }


                function loadGraphIframe2() {
            const container = document.getElementById('graphIframe2Container');
            if (!container) return;
            
            // Crear el iframe
            graphIframe2 = document.createElement('iframe');
            graphIframe2.src = 'Roomba_93.html';
            graphIframe2.allowFullscreen = true;
            
            // Agregar al contenedor
            container.appendChild(graphIframe2);
            graphIframe2Loaded = true;
            
            // Manejar errores
            graphIframe2.addEventListener('error', () => {
                container.innerHTML = '<p class="text-center p-4 text-red-500">Error al cargar la gr√°fica</p>';
            });
        }

        
        // --- Funciones de Sub-navegaci√≥n del Diario ---

        function showDiarySubTab(subTabName) {
            // Ocultar todas las sub-secciones
            diaryWriteEntrySection.classList.add('hidden');
            diaryViewSearchSection.classList.add('hidden');

            // Desactivar todos los botones de sub-pesta√±a
            diarySubTabButtons.forEach(button => button.classList.remove('active'));

            // Mostrar la sub-secci√≥n correspondiente
            if (subTabName === 'write') {
                diaryWriteEntrySection.classList.remove('hidden');
                document.querySelector('[data-diary-sub-tab="write"]').classList.add('active');
            } else if (subTabName === 'view') {
                diaryViewSearchSection.classList.remove('hidden');
                document.querySelector('[data-diary-sub-tab="view"]').classList.add('active');
                searchResultsDiv.innerHTML = '<p class="text-center text-gray-500">Usa el filtro de fechas para buscar entradas.</p>';
            }
            hideMessage();
        }

        // Event listeners para los botones de las sub-pesta√±as del diario
        diarySubTabButtons.forEach(button => {
            button.addEventListener('click', () => {
                showDiarySubTab(button.dataset.diarySubTab);
            });
        });

        // --- Funciones del Diario ---

        async function loadLatestEntry() {
            latestEntryContent.innerHTML = '<p class="text-center text-gray-500">Cargando √∫ltima entrada del diario...</p>';
            try {
                const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=getLatest`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const result = await response.json();

                if (result.status === 'success' && result.entry) {
                    latestEntryContent.innerHTML = '';
                    renderEntry(result.entry, latestEntryContent);
                } else {
                    latestEntryContent.innerHTML = `<p class="text-center text-gray-500">${result.message || 'No hay entradas para mostrar.'}</p>`;
                }
            } catch (error) {
                console.error('Error al cargar la √∫ltima entrada:', error);
                latestEntryContent.innerHTML = '<p class="text-center text-red-500">Error al cargar la √∫ltima entrada.</p>';
            }
        }


        async function loadLatestStory() {
  const latestStoryContent = document.getElementById('latestStoryContent');
  latestStoryContent.innerHTML = '<p class="text-center text-gray-500">Cargando √∫ltima historia...</p>';
  
  try {
    const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL_STORIES}?action=listarHistorias`);
    const result = await response.json();

    if (result.status === 'success' && result.historias.length > 0) {
      const historia = result.historias[0]; // La m√°s reciente (ya viene invertida)
      const card = document.createElement("div");
      card.className = "entry-card mb-4";
      card.innerHTML = `
        <h4 class='font-bold text-indigo-600'>${historia.titulo}</h4>
        <p class='text-sm text-gray-500'>${new Date(historia.fecha).toLocaleString()}</p>
        <div class='prose max-w-none mt-2 bg-white p-4 rounded-md shadow-sm border'>${historia.contenido}</div>
      `;
      latestStoryContent.innerHTML = '';
      latestStoryContent.appendChild(card);
    } else {
      latestStoryContent.innerHTML = `<p class="text-center text-gray-500">${result.message || 'No hay historias disponibles.'}</p>`;
    }
  } catch (error) {
    console.error('Error al cargar la √∫ltima historia:', error);
    latestStoryContent.innerHTML = '<p class="text-center text-red-500">Error al cargar la historia.</p>';
  }
}






        

        // Env√≠o del formulario del diario
        diaryForm.addEventListener('submit', async (e) => {
            e.preventDefault();
        
            hideMessage();
            buttonText.textContent = 'Guardando...';
            loadingSpinner.style.display = 'block';
            diaryForm.querySelector('button[type="submit"]').disabled = true;
        
            const title = document.getElementById('title').value.trim();
            const entryText = text.value;
            const externalImageUrl = externalImageUrlInput.value.trim();
            let imageData = null;
            let imageName = '';
        
            if (!title) {
                showMessage('Por favor, pon un t√≠tulo a tu entrada.', 'error');
                resetFormState();
                return;
            }
        
            if (!entryText.trim()) {
                showMessage('Por favor, escribe algo en tu entrada del diario.', 'error');
                resetFormState();
                return;
            }

            if (photoUpload.files.length > 0 && window._diaryPastedImage) {
    showMessage('Por favor, elige solo una opci√≥n para la imagen: archivo o pegada.', 'error');
    resetFormState();
    return;
}

        
            if (photoUpload.files.length > 0 && externalImageUrl !== '') {
                showMessage('Por favor, elige SOLO UNA opci√≥n para la imagen.', 'error');
                resetFormState();
                return;
            }
        
            if (photoUpload.files.length > 0) {
                const file = photoUpload.files[0];
                if (file.size > 5 * 1024 * 1024) {
                    showMessage('La imagen es demasiado grande (m√°x. 5MB).', 'error');
                    resetFormState();
                    return;
                }
                imageName = file.name;
                try {
                    imageData = await readFileAsBase64(file);
                } catch (error) {
                    showMessage('Error al leer la imagen.', 'error');
                    resetFormState();
                    return;
                }
            }
        
            const formData = new FormData();
               
                formData.append('title', title);           // Campo 1: T√≠tulo
                formData.append('diaryEntry', entryText);  // Campo 2: Texto del diario
                
                if (externalImageUrl !== '') {
                  formData.append('externalImageUrl', externalImageUrl);
                    } else if (window._diaryPastedImage) {
  formData.append('imageData', window._diaryPastedImage);
  formData.append('imageName', 'imagen_pegada.png');

                } else if (imageData) {
                  formData.append('imageData', imageData);
                  formData.append('imageName', imageName);
                }


        
            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    body: formData,
                });
        
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
        
                const result = await response.json();
        
                if (result.status === 'success') {
                    showMessage('¬°Entrada guardada con √©xito!', 'success');
                    text.value = '';
                    window._diaryPastedImage = null;

                    photoUpload.value = '';
                    externalImageUrlInput.value = '';
                    document.getElementById('title').value = ''; // limpiar t√≠tulo
                } else {
                    showMessage(`Error al guardar: ${result.message || 'Error desconocido'}`, 'error');
                }
            } catch (error) {
                console.error('Error al enviar la entrada:', error);
                showMessage('Error al conectar con el servidor.', 'error');
            } finally {
                resetFormState();
            }
        });


        // B√∫squeda de entradas por fecha
        searchEntriesBtn.addEventListener('click', async () => {
            const startDate = startDateInput.value;
            const endDate = endDateInput.value;

            if (!startDate || !endDate) {
                showMessage('Por favor, selecciona tanto la fecha de inicio como la de fin para buscar.', 'error');
                return;
            }

            if (new Date(startDate) > new Date(endDate)) {
                showMessage('La fecha de inicio no puede ser posterior a la fecha de fin.', 'error');
                return;
            }

            searchResultsDiv.innerHTML = '<p class="text-center text-gray-500">Buscando entradas...</p>';
            hideMessage();

            try {
                const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=getEntriesByDate&startDate=${startDate}&endDate=${endDate}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const result = await response.json();

                if (result.status === 'success' && result.entries && result.entries.length > 0) {
                    searchResultsDiv.innerHTML = '';
                    result.entries.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    result.entries.forEach(entry => renderEntry(entry, searchResultsDiv));
                } else {
                    searchResultsDiv.innerHTML = `<p class="text-center text-gray-500">${result.message || 'No se encontraron entradas para el rango de fechas seleccionado.'}</p>`;
                }
            } catch (error) {
                console.error('Error al buscar entradas:', error);
                searchResultsDiv.innerHTML = '<p class="text-center text-red-500">Error al buscar entradas. Int√©ntalo de nuevo.</p>';
            }
        });

        // --- Inicializaci√≥n ---
        document.addEventListener('DOMContentLoaded', () => {
            showMainTab('home');
        });
    </script>


<script>
function updateElapsedTime() {
  const startInput = document.getElementById("startElapsed").value;
  const endInput = document.getElementById("endElapsed").value;

  const startDate = startInput ? new Date(startInput) : new Date("1982-12-06T00:00:00");
  const endDate = endInput ? new Date(endInput) : new Date();

  const personasCeldaStr = document.getElementById('personasCeldaInput').value;
  const personasAfectadasStr = document.getElementById('personasAfectadasInput').value;

  let personasCelda = parseInt(personasCeldaStr) || 16;
  let personasAfectadas = parseInt(personasAfectadasStr) || 606;

  if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
    document.getElementById("elapsedDaysText").textContent = "Fechas no v√°lidas.";
    return;
  }

  const msElapsed = endDate - startDate;
  const totalSeconds2 = Math.floor(msElapsed * personasCelda * personasAfectadas / 1000); // Esto sigue siendo el total de segundos calculados con tus factores.

  // C√°lculos base para d√≠as, horas, minutos a partir de totalSeconds2
  const totalDays = Math.floor(totalSeconds2 / (60 * 60 * 24));
  const secondsAfterDays = totalSeconds2 % (60 * 60 * 24);

  const totalYears = Math.floor(totalSeconds2 / (60 * 60 * 24 *365.25));

  const hours = Math.floor(secondsAfterDays / (60 * 60));
  const minutes = Math.floor((secondsAfterDays % (60 * 60)) / 60);

  // **NUEVAS CONSTANTES DE CONVERSI√ìN BASADAS EN TU ACLARACI√ìN**
  const SECONDS_IN_STANDARD_DAY = 24 * 60 * 60; // 86400 segundos
  const CUCHUFLUS_PEQUENOS_PER_STANDARD_DAY = 200000;

  // Factor para convertir segundos est√°ndar (totalSeconds2) a :-_
  const conversion_factor_seconds_to_cuchuflus_pequenos = CUCHUFLUS_PEQUENOS_PER_STANDARD_DAY / SECONDS_IN_STANDARD_DAY;

  // Factores internos entre tus unidades (de la imagen):
  const CUCHUFLUS_MEDIANOS_PER_CUCHUFLUS_PEQUENO = 1 / 100; // 1 :- = 100 :-_  => 1 :-_ = 1/100 :-
  const CUCHUFLUS_GRANDES_PER_CUCHUFLUS_MEDIANO = 1 / 100; // 1 : = 100 :- => 1 :- = 1/100 :
  const SOLES_PER_CUCHUFLUS_GRANDE = 1 / 20; // 1 o = 20 : => 1 : = 1/20 o

  // Factor para "tiradas" (1 tirada = 1.7 segundos)
  const TIRADAS_PER_SECOND = 1 / 1.7;


  // For demonstration, let's just display these values
  const resultDiv = document.getElementById('resultDisplay');
  resultDiv.innerHTML = `
        <p>Fecha de Inicio: ${startDate.toLocaleString()}</p>
        <p>Fecha Fin: ${endDate.toLocaleString()}</p>
        <p>Personas en Celda (inicial): ${personasCelda}</p>
        <p>Personas Afectadas (inicial): ${personasAfectadas}</p>
        `;

  console.log("Start Date:", startDate);
  console.log("End Date:", endDate);
  console.log("Personas en Celda:", personasCelda);
  console.log("Personas Afectadas:", personasAfectadas);
  console.log("Total Seconds (totalSeconds2):", totalSeconds2);


  // Mostrar tiempo b√°sico
  document.getElementById("elapsedDaysText").textContent = `${totalDays} d√≠as, ${hours} horas y ${minutes} minutos.`;
  document.getElementById("elapsedYears").textContent = (totalYears).toLocaleString(undefined, {maximumFractionDigits: 2});
  document.getElementById("elapsedHours").textContent = (totalSeconds2 / (60 * 60)).toLocaleString(undefined, {maximumFractionDigits: 2});
  document.getElementById("elapsedMinutes").textContent = (totalSeconds2 / 60).toLocaleString(undefined, {maximumFractionDigits: 2});

  // Conversiones especiales
  let extra = document.getElementById("extraTimeUnits");
  if (!extra) {
    extra = document.createElement("div");
    extra.id = "extraTimeUnits";
    extra.className = "mt-6 p-4 bg-white rounded-lg shadow space-y-2 text-center text-gray-700";
    document.getElementById("mainTimeElapsedSection").appendChild(extra);
  }

  // C√°lculos usando las nuevas constantes
  const totalTiradas = totalSeconds2 * TIRADAS_PER_SECOND;
  const totalCuchuflusPequenos = totalSeconds2 * conversion_factor_seconds_to_cuchuflus_pequenos;
  const totalCuchuflusMedianos = totalCuchuflusPequenos * CUCHUFLUS_MEDIANOS_PER_CUCHUFLUS_PEQUENO;
  const totalCuchuflusGrandes = totalCuchuflusMedianos * CUCHUFLUS_GRANDES_PER_CUCHUFLUS_MEDIANO;
  const totalSoles = totalCuchuflusGrandes * SOLES_PER_CUCHUFLUS_GRANDE;


  extra.innerHTML = `
    <div><strong>Total en tiradas:</strong> ${totalTiradas.toLocaleString(undefined, {maximumFractionDigits: 2})}</div>
    <div><strong>Total en :-_ (Porciones peque√±as):</strong> ${totalCuchuflusPequenos.toLocaleString(undefined, {maximumFractionDigits: 2})}<strong> :-_ </strong></div>
    <div><strong>Total en :- (Porciones medianas):</strong> ${totalCuchuflusMedianos.toLocaleString(undefined, {maximumFractionDigits: 2})}<strong> :- </strong></div>
    <div><strong>Total en : (Porciones grandes):</strong> ${totalCuchuflusGrandes.toLocaleString(undefined, {maximumFractionDigits: 2})}<strong> : </strong></div>
    <div><strong>Total en o (Soles):</strong> ${totalSoles.toLocaleString(undefined, {maximumFractionDigits: 2})}<strong> o </strong></div>
  `;
}
</script>



    
    <!-- Insertar al final del <body>, antes del cierre -->
    <script>
      const SERVER_DATA_URL = "https://script.google.com/macros/s/AKfycbwXNtcVnXevJgk-fpMvqqkc4BeSbZZ_EutueaCAkakIaBK5sx7AQL-fZpN5R08uWNy3/exec";
      let mapa, capaMarcadores, ruta, datosCargados = [];
    
      function iniciarMapa() {
        mapa = L.map("mapid").setView([40.4168, -3.7038], 5);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          attribution: '&copy; OpenStreetMap',
        }).addTo(mapa);
    
        capaMarcadores = L.featureGroup().addTo(mapa);
        ruta = L.polyline([], { color: 'blue' }).addTo(mapa);
        cargarDatosMapa();
      }
    
      async function cargarDatosMapa() {
        try {
          const res = await fetch(SERVER_DATA_URL);
          const datos = await res.json();
    
          if (!Array.isArray(datos) || datos.length === 0) {
            console.warn("No se recibieron datos v√°lidos.");
            document.getElementById("tablaDatosMapa").innerHTML = '<tr><td colspan="9" class="px-4 py-2 text-center text-gray-500">No hay datos disponibles</td></tr>';
            return;
          }
    
          datosCargados = datos;
          procesarYMostrarDatos(datos);
        } catch (error) {
          console.error("Error al obtener datos:", error);
          document.getElementById("tablaDatosMapa").innerHTML = '<tr><td colspan="9" class="px-4 py-2 text-center text-red-500">Error al obtener datos</td></tr>';
        }
      }
    
      function procesarYMostrarDatos(datos) {
        const cuerpoTabla = document.getElementById("tablaDatosMapa");
        cuerpoTabla.innerHTML = "";
        capaMarcadores.clearLayers();
        ruta.setLatLngs([]);
        const coordenadasRuta = [];
    
        datos.forEach((dato) => {
          const { Timestamp, Hour, Latitude, Longitude, Altitude, Pulse, SpO2, Steps, Temperature } = dato;
    
          if (!Latitude || !Longitude || !Altitude) return;
          const lat = parseFloat(Latitude);
          const lon = parseFloat(Longitude);
          const alt = parseFloat(Altitude);
          coordenadasRuta.push([lat, lon, alt]);
    
          const anomal√≠a =
            Pulse < 40 || Pulse > 120 ||
            SpO2 < 90 || SpO2 > 100 ||
            Temperature < 35.0 || Temperature > 37.5 ? "‚ö†Ô∏è" : "";
    
          const fila = `<tr>
            <td class="px-4 py-1">${new Date(Timestamp).toLocaleDateString()}</td>
          

            <td class="px-4 py-1">${new Date(Timestamp).toLocaleTimeString("es-ES", { hour: "2-digit", minute: "2-digit" })}</td>

            <td class="px-4 py-1">${lat.toFixed(4)}</td>
            <td class="px-4 py-1">${lon.toFixed(4)}</td>
            <td class="px-4 py-1">${alt.toFixed(1)}</td>
            <td class="px-4 py-1">${Pulse}</td>
            <td class="px-4 py-1">${SpO2}</td>
            <td class="px-4 py-1">${Steps}</td>
            <td class="px-4 py-1">${Temperature}</td>
            <td class="px-4 py-1">${anomal√≠a}</td>
          </tr>`;
          cuerpoTabla.insertAdjacentHTML("beforeend", fila);
    
          const fecha = new Date(Timestamp);
            const hora = fecha.toLocaleTimeString("es-ES", { hour: "2-digit", minute: "2-digit" });
            
            const marker = L.marker([lat, lon]).bindPopup(
              `üïí ${hora}<br/>ü´Ä Pulso: ${Pulse}<br/>üß™ SpO2: ${SpO2}<br/>üå° Temp: ${Temperature}`
            );

          capaMarcadores.addLayer(marker);
        });
    
        ruta.setLatLngs(coordenadasRuta);
        if (coordenadasRuta.length > 0) mapa.fitBounds(ruta.getBounds());
      }
    
      function filtrarDatosMapa() {
        const desde = new Date(document.getElementById("mapStartDate").value);
        const hasta = new Date(document.getElementById("mapEndDate").value);


        if (!datosCargados.length || isNaN(desde) || isNaN(hasta)) return;
    
        const filtrados = datosCargados.filter(d => {
          const fecha = new Date(d.Timestamp);
          return fecha >= desde && fecha <= hasta;
        });
        procesarYMostrarDatos(filtrados);
      }
    </script>

    <script>
        function normalize(str) {
          try {
            return (str || '').toString().normalize('NFD').replace(/[\u0300-\u036f]/g, '').trim().toLowerCase();
          } catch (e) {
            Logger.log('‚ùå Error en normalizar(): ' + e.message + ' | Valor: ' + str);
            return '';
          }
        }

        
        function buscarPorTitulo() {
          console.log('üü£ buscarPorTitulo() llamada');
        
          const raw = document.getElementById('searchTitle').value.trim();
          const keyword = normalize(raw);
          console.log('üî§ Palabra clave normalizada:', keyword);
        
          if (!keyword) {
            showMessage('Introduce una palabra clave para buscar.', 'error');
            return;
          }
        
          showMainTab('diary');
          diaryWriteEntrySection.classList.add('hidden');
          diaryViewSearchSection.classList.remove('hidden');
          diarySubTabButtons.forEach(button => button.classList.remove('active'));
          document.querySelector('[data-diary-sub-tab="view"]').classList.add('active');
        
          searchResultsDiv.innerHTML = '<p class="text-center text-gray-500">Buscando...</p>';
          hideMessage();
        
          const url = `${GOOGLE_APPS_SCRIPT_URL}?action=searchByTitle&keyword=${encodeURIComponent(keyword)}`;
          console.log('üåê Haciendo fetch a:', url);
        
          fetch(url)
            .then(res => res.json())
            .then(data => {
              console.log('üì¶ Respuesta recibida:', data);
              if (data.status === 'success' && data.entries.length > 0) {
                searchResultsDiv.innerHTML = '';
                data.entries.forEach(entry => {
                  console.log('‚úÖ Entrada recibida:', entry);
                  searchResultsDiv.innerHTML += `
                    <div style="border:1px solid #ccc; margin-bottom:1em; padding:1em;">
                      <strong>${entry.title}</strong><br>
                      <em>${entry.timestamp}</em><br>
                      <p>${entry.text}</p>
                      ${entry.photoUrl !== 'No hay foto' ? `<img src="${entry.photoUrl}" style="max-width:100%">` : ''}
                    </div>`;
                });
              } else {
                console.log('‚ö†Ô∏è No se encontraron entradas');
                searchResultsDiv.innerHTML = '<p class="text-center text-gray-500">No se encontraron coincidencias.</p>';
              }
            })
            .catch(err => {
              console.error('‚ùå Error en fetch:', err);
              showMessage('Error al buscar por t√≠tulo.', 'error');
            });
        }
    </script>

  

     <script>
// Modifica la funci√≥n que carga las canciones para inicializar los filtros
fetch('music_list.json')
  .then(res => res.json())
  .then(data => {
    songs = data;
    
    // Inicializar filtro de g√©neros
    const generos = [...new Set(data.map(song => song.genre).filter(Boolean))];
    const filterGenre = document.getElementById('filterGenre');
    generos.forEach(genero => {
      const option = document.createElement('option');
      option.value = genero;
      option.textContent = genero;
      filterGenre.appendChild(option);
    });
    
    // Inicializar filtro de artistas
    const artistas = [...new Set(data.map(song => song.artist).filter(Boolean))];
    const filterArtist = document.getElementById('filterArtist');
    artistas.forEach(artista => {
      const option = document.createElement('option');
      option.value = artista;
      option.textContent = artista;
      filterArtist.appendChild(option);
    });
    
    renderSongList();
    renderFullSelect();
    playTrack(0);
  })
  .catch(err => {
    currentSongSpan.textContent = 'Error al cargar canciones';
    console.error('Error:', err);
  });
    </script>

<script>
const audio = document.getElementById('audio');
    const songListElement = document.getElementById('songList');
    const currentSongSpan = document.getElementById('currentSong');
    const nextSongSpan = document.getElementById('nextSong');
    const fullSongSelect = document.getElementById('fullSongSelect');

    let songs = [];
    let currentTrack = 0;
    let isShuffling = false;
    let repeatMode = 'off'; // 'off', 'one', 'all'

    fetch('music_list.json')
      .then(res => res.json())
      .then(data => {
        songs = data;
        renderSongList();
        renderFullSelect();
        playTrack(0);
      })
      .catch(err => {
        currentSongSpan.textContent = 'Error al cargar canciones';
        console.error('Error:', err);
      });

function renderSongList() {
  songListElement.innerHTML = '';
  const start = Math.max(currentTrack - 5, 0);
  const end = Math.min(currentTrack + 6, songs.length);

  for (let i = start; i < end; i++) {
    const li = document.createElement('li');
    // Cambiar esta l√≠nea para mostrar artista y t√≠tulo
    li.innerHTML = (i === currentTrack ? 'üîä ' : '') + 
                  (songs[i].artist ? `${songs[i].artist} - ` : '') + 
                  (songs[i].title || `Canci√≥n ${i + 1}`);
    
    li.classList.add('cursor-pointer', 'py-1', 'px-2', 'rounded-md');

    if (i === currentTrack) {
      li.classList.add('bg-indigo-100', 'text-indigo-700', 'border', 'border-indigo-400', 'font-bold');
    } else {
      li.classList.add('hover:bg-gray-100');
    }

    const song = songs[i];
    li.title = `Artista: ${song.artist}\n√Ålbum: ${song.album}\nG√©nero: ${song.genre}\nA√±o: ${song.year}\nDuraci√≥n: ${Math.floor(song.duration / 60)}:${String(song.duration % 60).padStart(2, '0')}`;

    li.onclick = () => playTrack(i);
    songListElement.appendChild(li);
  }
}

function renderFullSelect() {
  fullSongSelect.innerHTML = '<option disabled selected>-- Elegir canci√≥n --</option>';
  songs.forEach((song, i) => {
    const option = document.createElement('option');
    option.value = i;
    // Cambiar esta l√≠nea para mostrar artista y t√≠tulo
    option.textContent = (song.artist ? `${song.artist} - ` : '') + (song.title || `Canci√≥n ${i + 1}`);
    fullSongSelect.appendChild(option);
  });
}

    function playTrack(index) {
      if (!songs[index]) return;

      currentTrack = index;
      const song = songs[index];
      const next = songs[(index + 1) % songs.length];

      audio.src = song.url;
      currentSongSpan.textContent = `${song.title} - ${song.artist} (${song.genre})`;
      nextSongSpan.textContent = `Siguiente: ${next?.title} - ${next?.artist}`;

      audio.play().catch(err => console.error('Reproducci√≥n fallida:', err));
      audio.onloadedmetadata = () => {
        const duracion = audio.duration;
        audio.dataset.duracion = Math.round(duracion);
      };

      renderSongList();
      fullSongSelect.selectedIndex = index + 1; // +1 por el placeholder
    }

    function prevTrack() {
      currentTrack = (currentTrack - 1 + songs.length) % songs.length;
      playTrack(currentTrack);
    }

    function nextTrack() {
      if (repeatMode === 'one') {
        playTrack(currentTrack);
      } else if (isShuffling) {
        let next;
        do {
          next = Math.floor(Math.random() * songs.length);
        } while (songs.length > 1 && next === currentTrack);
        playTrack(next);
      } else {
        if (currentTrack + 1 < songs.length) {
          playTrack(currentTrack + 1);
        } else if (repeatMode === 'all') {
          playTrack(0);
        }
      }
    }

    audio.addEventListener('ended', nextTrack);

    fullSongSelect.addEventListener('change', (e) => {
      const index = parseInt(e.target.value);
      if (!isNaN(index)) playTrack(index);
    });

function toggleShuffle() {
  isShuffling = !isShuffling;
  const shuffleBtn = document.getElementById('shuffleBtn');
  
  if (isShuffling) {
    shuffleBtn.innerHTML = 'üîÄ Shuffle ON';
    shuffleBtn.classList.add('bg-indigo-500', 'text-white');
    shuffleBtn.classList.remove('bg-gray-300', 'text-gray-800');
  } else {
    shuffleBtn.innerHTML = 'üîÄ Shuffle OFF'; 
    shuffleBtn.classList.remove('bg-indigo-500', 'text-white');
    shuffleBtn.classList.add('bg-gray-300', 'text-gray-800');
  }
}

// Inicializar el estado del bot√≥n al cargar
document.addEventListener('DOMContentLoaded', () => {
  const shuffleBtn = document.getElementById('shuffleBtn');
  shuffleBtn.innerHTML = 'üîÄ Shuffle OFF';
});

    function toggleRepeat() {
      const btn = document.getElementById('repeatBtn');
      if (repeatMode === 'off') {
        repeatMode = 'all';
        btn.innerText = 'üîÅ Repeat All';
        btn.classList.replace('bg-gray-300', 'bg-indigo-500');
        btn.classList.replace('text-gray-800', 'text-white');
      } else if (repeatMode === 'all') {
        repeatMode = 'one';
        btn.innerText = 'üîÇ Repeat One';
      } else {
        repeatMode = 'off';
        btn.innerText = '‚ùå Repeat Off';
        btn.classList.replace('bg-indigo-500', 'bg-gray-300');
        btn.classList.replace('text-white', 'text-gray-800');
      }
    }


    
function obtenerLetraDesdeAppScript() {
  const song = songs[currentTrack];
  const title = (song?.title || '').replace(/^\\d+\\s*/, '');
  const artist = song?.artist || '';

  if (!title || !artist) {
    alert('Faltan datos para buscar la letra.');
    return;
  }

  const queryUrl = 'https://script.google.com/macros/s/AKfycbwKbQu7K1Hy8ovtyCEfo6VNC3W1MQGEw8VEaDoINR3tglgwe1Fvtq21H0JK9mt7jSs3FQ/exec' +
    '?title=' + encodeURIComponent(title) +
    '&artist=' + encodeURIComponent(artist);

  fetch(queryUrl)
    .then(res => res.text())
    .then(lyric => {
      const div = document.getElementById('letraCancion');
const letraTexto = document.getElementById('letraTexto');
letraTexto.textContent = lyric;
div.classList.remove('hidden');

    })
    .catch(err => {
      console.error(err);
      alert('Error al buscar la letra');
    });
}

</script>



<script>
// A√±ade estas funciones al script existente de la radio
function ordenarPor(criterio) {
  songs.sort((a, b) => {
    // Para duraci√≥n, orden num√©rico
    if (criterio === 'duration') {
      return a.duration - b.duration;
    }
    // Para otros campos, orden alfab√©tico
    const valA = a[criterio] || '';
    const valB = b[criterio] || '';
    return valA.toString().localeCompare(valB.toString());
  });
  
  // Si ya est√°bamos mostrando una canci√≥n, mantenemos la selecci√≥n
  const currentUrl = songs[currentTrack]?.url;
  renderSongList();
  renderFullSelect();
  
  // Restauramos la canci√≥n actual si existe
  if (currentUrl) {
    const newIndex = songs.findIndex(song => song.url === currentUrl);
    if (newIndex !== -1) {
      currentTrack = newIndex;
      playTrack(currentTrack);
    }
  }
}

function mezclarCanciones() {
  // Mezcla las canciones pero mantiene la actual reproduci√©ndose
  const currentUrl = songs[currentTrack]?.url;
  
  // Algoritmo de Fisher-Yates para mezclar
  for (let i = songs.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [songs[i], songs[j]] = [songs[j], songs[i]];
  }
  
  renderSongList();
  renderFullSelect();
  
  // Encuentra y reproduce la canci√≥n que estaba sonando
  if (currentUrl) {
    const newIndex = songs.findIndex(song => song.url === currentUrl);
    if (newIndex !== -1) {
      currentTrack = newIndex;
    }
  }
}

function filtrarPorGenero() {
  const genero = document.getElementById('filterGenre').value;
  if (!genero) {
    renderSongList();
    return;
  }
  
  const filtered = songs.filter(song => song.genre === genero);
  renderFilteredList(filtered);
}

function filtrarPorArtista() {
  const artista = document.getElementById('filterArtist').value;
  if (!artista) {
    renderSongList();
    return;
  }
  
  const filtered = songs.filter(song => song.artist === artista);
  renderFilteredList(filtered);
}

function renderFilteredList(filteredSongs) {
  songListElement.innerHTML = '';
  
  filteredSongs.forEach((song, i) => {
    const li = document.createElement('li');
    li.innerHTML = (songs[currentTrack]?.url === song.url ? 'üîä ' : '') + 
                  (song.artist ? `${song.artist} - ` : '') + 
                  (song.title || `Canci√≥n ${i + 1}`);
    
    li.classList.add('cursor-pointer', 'py-1', 'px-2', 'rounded-md');
    
    if (songs[currentTrack]?.url === song.url) {
      li.classList.add('bg-indigo-100', 'text-indigo-700', 'border', 'border-indigo-400', 'font-bold');
    } else {
      li.classList.add('hover:bg-gray-100');
    }
    
    li.title = `Artista: ${song.artist}\n√Ålbum: ${song.album}\nG√©nero: ${song.genre}\nA√±o: ${song.year}\nDuraci√≥n: ${Math.floor(song.duration / 60)}:${String(song.duration % 60).padStart(2, '0')}`;
    li.onclick = () => {
      const originalIndex = songs.findIndex(s => s.url === song.url);
      if (originalIndex !== -1) {
        currentTrack = originalIndex;
        playTrack(currentTrack);
      }
    };
    songListElement.appendChild(li);
  });
}




</script>


















    

<script>
function uploadToDrive() {
  const fileInput = document.getElementById('uploader');
  const file = fileInput.files[0];
  if (!file) return alert('Selecciona un archivo');

  const reader = new FileReader();
  reader.onloadend = () => {
    const base64 = reader.result.split(',')[1];
    const form = new FormData();
    form.append('file', base64);
    form.append('name', file.name);
    form.append('mimeType', file.type);

    fetch('https://script.google.com/macros/s/AKfycbx6z96Chi3PZU9ty9-5uP6RqnyzVXK0nPPxqHjuKRWccGI9LOh8anyKrP_iCRsQ25akUg/exec', {
      method: 'POST',
      body: form,
    })
    .then(res => res.text())
    .then(text => {
      document.getElementById('resultado').textContent = text;
      fileInput.value = ""; // ‚úÖ ahora se limpia correctamente
    })
    .catch(err => {
  console.error(err);
  document.getElementById('resultado').textContent = '‚ùå Error al subir: ' + err.message;
});

  };
  reader.readAsDataURL(file);
}



    const dropZone = document.getElementById("dropZone");
const uploader = document.getElementById("uploader");

// üëá Aqu√≠ a√±ades esto:
uploader.addEventListener("change", () => {
  if (uploader.files.length > 0) {
    document.getElementById("resultado").textContent = "üì§ Subiendo archivo...";
    uploadToDrive();
  }
});

dropZone.addEventListener("click", () => uploader.click());

dropZone.addEventListener("dragover", e => {
  e.preventDefault();
  dropZone.style.background = "#ddd6fe";
});
dropZone.addEventListener("dragleave", () => {
  dropZone.style.background = "";
});
dropZone.addEventListener("drop", e => {
  e.preventDefault();
  dropZone.style.background = "";
  if (e.dataTransfer.files.length) {
    uploader.files = e.dataTransfer.files;
    document.getElementById("resultado").textContent = "üì§ Preparando archivo...";
    setTimeout(() => {
      uploadToDrive();
    }, 200);
  }
});




</script>

       
        <!-- Scripts necesarios (Quill y funcionalidad) Stories -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
<script>
     const GOOGLE_APPS_SCRIPT_URL_STORIES = 'https://script.google.com/macros/s/AKfycbxlsi6XOluJVVmmZ-qwAN_1QlEPg-6qEuaBSKoUwiMiPGHzCHY_H-QD34Fg-Ita2Bli/exec'; 

let quill;
document.addEventListener("DOMContentLoaded", () => {
  quill = new Quill('#storyEditor', { theme: 'snow' });

    document.querySelector('#storyEditor').addEventListener('paste', async function (e) {
  const clipboard = e.clipboardData;
  if (!clipboard || !clipboard.items) return;

  for (const item of clipboard.items) {
    if (item.type.indexOf('image') !== -1) {
      e.preventDefault(); // evita pegado directo
      const file = item.getAsFile();
      const reader = new FileReader();

      reader.onload = async function (event) {
        const base64 = event.target.result;

        const form = new FormData();
        form.append('action', 'subirImagen');
        form.append('imagen', base64);

        const res = await fetch(GOOGLE_APPS_SCRIPT_URL_STORIES, {
          method: 'POST',
          body: form
        });

        const data = await res.json();
        if (data.status === 'success') {
          const range = quill.getSelection();
          quill.insertEmbed(range.index, 'image', data.url);
        } else {
          alert('Error al subir la imagen: ' + data.message);
        }
      };

      reader.readAsDataURL(file);
    }
  }
});



    
  document.querySelector('[data-main-tab="stories"]').addEventListener('click', cargarHistorias);
});

function mostrarMensajeHistoria(msg, tipo) {
  const box = document.getElementById("storyMessage");
  box.className = `message-box ${tipo}`;
  box.textContent = msg;
  box.style.display = 'block';
}

function procesarVideos(html) {
  const div = document.createElement('div');
  div.innerHTML = html;

  const enlaces = div.querySelectorAll('a');
  enlaces.forEach(enlace => {
    const url = enlace.href;
    let embed;

    if (url.includes('youtube.com/watch?v=')) {
      const id = url.split('v=')[1].split('&')[0];
      embed = `<iframe width="100%" height="315" src="https://www.youtube.com/embed/${id}" frameborder="0" allowfullscreen></iframe>`;
    } else if (url.includes('youtu.be/')) {
      const id = url.split('youtu.be/')[1];
      embed = `<iframe width="100%" height="315" src="https://www.youtube.com/embed/${id}" frameborder="0" allowfullscreen></iframe>`;
    } else if (url.includes('vimeo.com/')) {
      const id = url.split('vimeo.com/')[1];
      embed = `<iframe src="https://player.vimeo.com/video/${id}" width="100%" height="315" frameborder="0" allowfullscreen></iframe>`;
    }

    if (embed) {
      const wrapper = document.createElement('div');
      wrapper.innerHTML = embed;
      enlace.parentNode.replaceChild(wrapper, enlace);
    }
  });

  return div.innerHTML;
}

    
    

function guardarHistoria() {
  const titulo = document.getElementById('storyTitle').value.trim();
  let contenido = quill.root.innerHTML;

  if (!titulo || !contenido) return mostrarMensajeHistoria("Faltan datos.", "error");

  contenido = procesarVideos(contenido); // üîÑ Inserta los iframes embebidos

  const form = new FormData();
  form.append("action", "guardarHistoria");
  form.append("titulo", titulo);
  form.append("contenido", contenido);

  fetch(GOOGLE_APPS_SCRIPT_URL_STORIES, { method: 'POST', body: form })
    .then(res => res.json())
    .then(data => {
      if (data.status === 'success') {
        mostrarMensajeHistoria("‚úÖ Guardada", "success");
        document.getElementById("storyTitle").value = "";
        quill.setContents([]);
        cargarHistorias();
      } else {
        mostrarMensajeHistoria("‚ùå Error al guardar", "error");
      }
    });
}


    

async function cargarHistorias() {
  const contenedor = document.getElementById('storyList');
  contenedor.innerHTML = '<p class="text-center text-gray-500">Cargando t√≠tulos de historias...</p>';

  try {
    const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL_STORIES}?action=listarHistorias`);
    const result = await response.json();

    if (result.status === 'success') {
      contenedor.innerHTML = '';
      result.historias.forEach((historia, index) => {
        const wrapper = document.createElement('div');
        wrapper.className = 'mb-2';

        const titulo = document.createElement('div');
        titulo.className = 'entry-card p-3 text-sm bg-white shadow-sm rounded-md hover:bg-indigo-50 cursor-pointer';
        titulo.textContent = `üìò ${historia.titulo} ‚Äî ${new Date(historia.fecha).toLocaleDateString()}`;

        const contenido = document.createElement('div');
        contenido.className = 'hidden bg-white p-4 rounded-md border mt-1 prose max-w-none';
        contenido.innerHTML = `
          <p class="text-sm text-gray-500 mb-2"><strong>Publicado:</strong> ${new Date(historia.fecha).toLocaleString()}</p>
          ${historia.contenido}
        `;

        titulo.addEventListener('click', () => {
          contenido.classList.toggle('hidden');
        });

        wrapper.appendChild(titulo);
        wrapper.appendChild(contenido);
        contenedor.appendChild(wrapper);
      });
    } else {
      contenedor.innerHTML = `<p class="text-center text-gray-500">${result.message || 'No hay historias disponibles.'}</p>`;
    }
  } catch (error) {
    console.error('Error al cargar historias:', error);
    contenedor.innerHTML = '<p class="text-center text-red-500">Error al conectar con el servidor.</p>';
  }
}




    async function buscarHistorias() {
  const keyword = document.getElementById('searchKeyword').value.trim();
  const desde = document.getElementById('searchStartDate').value;
  const hasta = document.getElementById('searchEndDate').value;
  const contenedor = document.getElementById('searchStoryResults');

  contenedor.innerHTML = '<p class="text-center text-gray-500">Buscando...</p>';

  const url = `${GOOGLE_APPS_SCRIPT_URL_STORIES}?action=buscarHistorias&keyword=${encodeURIComponent(keyword)}&desde=${desde}&hasta=${hasta}`;

  try {
    const res = await fetch(url);
    const data = await res.json();

    if (data.status === 'success') {
      if (!data.historias.length) {
        contenedor.innerHTML = '<p class="text-center text-gray-500">No se encontraron historias.</p>';
        return;
      }

      contenedor.innerHTML = '';
      data.historias.forEach(historia => {
        const card = document.createElement('div');
        card.className = 'entry-card mb-4';
        card.innerHTML = `
          <h4 class='font-bold text-indigo-600'>${historia.titulo}</h4>
          <p class='text-sm text-gray-500'>${new Date(historia.fecha).toLocaleString()}</p>
          <div class='prose max-w-none mt-2 bg-white p-4 rounded-md shadow-sm border'>${historia.contenido}</div>
        `;
        contenedor.appendChild(card);
      });
    } else {
      contenedor.innerHTML = `<p class="text-center text-red-500">${data.message || 'Error al buscar.'}</p>`;
    }
  } catch (error) {
    console.error('Error al buscar historias:', error);
    contenedor.innerHTML = '<p class="text-center text-red-500">Error al conectar con el servidor.</p>';
  }
}




    
</script>


        <!--     Conversor de teimpo -->

<script>

function convertTime() {
    const conversionRates = {
        // "tiradas" (rolls) conversions
        tiradas: {
            segundos: 1.7, // 10 tiradas = 17 segundos => 1 tirada = 1.7 segundos
            // Derived from: 1 tirada = 1.7 segundos and 1 :-_ = 0.432 segundos
            ":-_": 1.7 / 0.432, // 1 tirada = 3.935185185 :-_ (from image: 1/0.2541176471)
            ":-": (1.7 / 0.432) / 100, // 1 :- = 100 :-_
            ":": ((1.7 / 0.432) / 100) / 100, // 1 : = 100 :-
            o: 1.7 / 86400, // 1 'o' = 86400 segundos
            minutos: 1.7 / 60,
            horas: 1.7 / 3600,
            dias: 1.7 / 86400
        },
        // "segundos" (seconds) conversions
        segundos: {
            tiradas: 0.5882352941, // 1 segundo = 0.5882352941 tiradas (from image)
            ":-_": 1 / 0.432, // 1 :-_ = 0.432 segundos => 1 segundo = 1/0.432 :-_ (from image 0.432 segundos = 1 :-_)
            ":-": (1 / 0.432) / 100, // 1 :- = 100 :-_
            ":": ((1 / 0.432) / 100) / 100, // 1 : = 100 :-
            o: 1 / 86400, // 1 'o' = 86400 segundos (from image)
            minutos: 1 / 60,
            horas: 1 / 3600,
            dias: 1 / 86400
        },
        // "o" (soles/days) conversions
        o: {
            segundos: 86400, // 1 dia = 86400 segundos (from image)
            tiradas: 86400 / 1.7, // Derived from segundos to tiradas
            ":-_": 200000, // 1 'o' = 200000 ':-_' (from image)
            ":-": 200000 / 100, // 1 :- = 100 :-_
            ":": 20, // 1 'o' = 20 ':' (from image)
            minutos: 24 * 60, // 1 dia = 24 horas * 60 minutos/hora (from image)
            horas: 24, // 1 dia = 24 horas (from image)
            dias: 1
        },
        // ":" (large sun portions) conversions
        ":": {
            segundos: 86400 / 20, // 1 o = 20 : and 1 o = 86400 segundos
            tiradas: (86400 / 20) / 1.7, // Derived from segundos to tiradas
            ":-_": 10000, // 1 : = 100 :- = 100 * 100 :-_ = 10000 :-_ (derived from image: 1 : = 100 :- and 1 :- = 100 :-_)
            ":-": 100, // 1 : = 100 :- (from image)
            o: 1 / 20, // 20 : = 1 o => 1 : = 1/20 o (from image)
            minutos: (86400 / 20) / 60,
            horas: (86400 / 20) / 3600,
            dias: 1 / 20
        },
        // ":-" (medium sun portions) conversions
        ":-": {
            segundos: 43.2, // 1 :- = 100 :-_ and 1 :-_ = 0.432 segundos
            tiradas: 43.2 / 1.7, // Derived from segundos to tiradas
            ":-_": 100, // 1 :- = 100 :-_ (from image)
            ":": 1 / 100, // 1 : = 100 :- => 1 :- = 1/100 : (from image)
            o: (1 / 20) / 100, // 1 o = 20 : and 1 : = 100 :- => 1 o = 2000 :- => 1 :- = 1/2000 o
            minutos: 43.2 / 60,
            horas: 43.2 / 3600,
            dias: 43.2 / 86400
        },
        // ":-_" (small sun portions) conversions
        ":-_": {
            segundos: 0.432, // 1 :-_ = 0.432 segundos (from image)
            tiradas: 0.2541176471, // 1 tirada = 3.935185185 :-_ => 1 :-_ = 1/3.935185185 tiradas = 0.2541176471 tiradas (from image)
            ":-": 1 / 100, // 1 :- = 100 :-_ => 1 :-_ = 1/100 :- (from image)
            ":": 1 / 10000, // 1 : = 100 :- and 1 :- = 100 :-_ => 1 : = 10000 :-_ => 1 :-_ = 1/10000 : (from image)
            o: 1 / 200000, // 1 'o' = 200000 ':-_' (from image)
            minutos: 0.432 / 60,
            horas: 0.432 / 3600,
            dias: 0.432 / 86400
        },
        // "dia" (day) conversions - explicitly defined as per image
        dia: {
            segundos: 86400, // From image
            h: 24, // From image
            min: 60 * 24, // 1 dia = 24h, 1h = 60min
            o: 1, // 1 dia = 1 o (implied)
            tiradas: 86400 / 1.7,
            ":-_": 200000, // From image
            ":-": 200000 / 100,
            ":": 20
        },
        // "h" (hours) conversions - explicitly defined as per image
        h: {
            min: 60, // From image
            sec: 3600, // 1h = 60min, 1min = 60sec
            dia: 1 / 24, // From image
            segundos: 3600,
            tiradas: 3600 / 1.7,
            ":-_": 3600 / 0.432,
            ":-": 3600 / 43.2,
            ":": 3600 / 4320,
            o: 3600 / 86400
        },
        // "min" (minutes) conversions - explicitly defined as per image
        min: {
            sec: 60, // From image
            h: 1 / 60, // From image
            dia: 1 / (24 * 60), // Derived from dia to h to min
            segundos: 60,
            tiradas: 60 / 1.7,
            ":-_": 60 / 0.432,
            ":-": 60 / 43.2,
            ":": 60 / 4320,
            o: 60 / 86400
        }
        // "minutos", "horas", "dias" are implicitly covered by "min", "h", "dia" respectively.
        // Keeping them for semantic clarity if they are used elsewhere in the code
        // but their values will directly map to the above.
    };
    
    const fromValue = parseFloat(document.getElementById('fromValue').value);
    const fromUnit = document.getElementById('fromUnit').value;
    const toUnit = document.getElementById('toUnit').value;

    if (isNaN(fromValue)) {
        alert("Por favor ingresa un valor v√°lido");
        return;
    }

    if (fromUnit === toUnit) {
        document.getElementById('toValue').value = fromValue;
        return;
    }

    let result;
    if (conversionRates[fromUnit] && conversionRates[fromUnit][toUnit]) {
        result = fromValue * conversionRates[fromUnit][toUnit];
    } else if (conversionRates[toUnit] && conversionRates[toUnit][fromUnit]) {
        result = fromValue / conversionRates[toUnit][fromUnit];
    } else {
        // Conversi√≥n indirecta a trav√©s de segundos
        const inSeconds = fromValue * conversionRates[fromUnit].segundos;
        result = inSeconds * conversionRates.segundos[toUnit];
    }

    document.getElementById('toValue').value = result.toFixed(6);
}

</script>




<script>
function sanitizeNumberInput(input) {
    input.value = input.value.replace(/[^\d]/g, '');
}

function translateNumber() {
    const input = document.getElementById('numberInput');
    const number = input.value.trim();
    const resultDiv = document.getElementById('symbolsResult');
    
    resultDiv.innerHTML = '';
    
    if (!number) {
        resultDiv.innerHTML = '<p style="color: #ef4444; text-align: center; width: 100%;">Por favor ingresa un n√∫mero</p>';
        return;
    }
    
    // Contenedor principal con scroll horizontal
    const container = document.createElement('div');
    container.style.display = 'inline-block';
    container.style.whiteSpace = 'nowrap';
    
    for (const digit of number) {
        const symbolContainer = document.createElement('div');
        symbolContainer.style.display = 'inline-block';
        symbolContainer.style.margin = '0 2px';
        symbolContainer.style.verticalAlign = 'middle';
        
        const img = document.createElement('img');
        img.src = `UniversalSistemNumbers/${digit}.jpg`;
        img.alt = `S√≠mbolo del n√∫mero ${digit}`;
        img.style.width = '50px';
        img.style.height = '50px';
        img.style.objectFit = 'contain';
        img.style.display = 'inline-block';
        
        img.onerror = function() {
            const fallback = document.createElement('div');
            fallback.style.display = 'inline-flex';
            fallback.style.width = '50px';
            fallback.style.height = '50px';
            fallback.style.alignItems = 'center';
            fallback.style.justifyContent = 'center';
            fallback.style.backgroundColor = '#e5e7eb';
            fallback.style.color = '#374151';
            fallback.style.fontWeight = 'bold';
            fallback.style.borderRadius = '0.25rem';
            fallback.textContent = digit;
            symbolContainer.replaceChild(fallback, img);
        };
        
        symbolContainer.appendChild(img);
        container.appendChild(symbolContainer);
    }
    
    resultDiv.appendChild(container);
    
    if (container.children.length === 0) {
        resultDiv.innerHTML = '<p style="color: #ef4444; text-align: center; width: 100%;">No se encontraron s√≠mbolos para mostrar</p>';
    }
}
</script>




    

</body>
</html>
